{% extends "home/base.html" %}
{% load static %}
{% load humanize %}
{% block addon_css %}
<link rel="stylesheet" href="{% static 'home/css/nv.d3.min.css' %}" type="text/css" />
<link rel="stylesheet" href="{% static 'home/css/nvd3-update.css' %}" type="text/css" />
<link href="{% static 'home/css/bootstrap-responsive.css' %}" rel="stylesheet" media="screen">
<style>
        .node circle {
            /*fill: #fff;*/
            /*stroke: DarkGreen;*/
            /*fill: DarkGreen;*/
            stroke: #000000;
            stroke-width: .3px;
        }

        .node {
            font: 8px sans-serif;
        }

        .link {
            fill: none;
            stroke: #eee;
            stroke-width: 1px;
        }

        .node text {
            font: 8px sans-serif;
        }

        .links {
            fill: none;
            stroke: #000;
        }

        .link-extensions {
            fill: none;
            stroke: #000;
            stroke-opacity: .25;
        }

        body {
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            margin: 0;
        }

        .links {
            fill: none;
            stroke: #000;
        }

        .link-extensions {
            fill: none;
            stroke: #000;
            stroke-opacity: .25;
        }


        .link--active {
            stroke: #000 !important;
            stroke-width: 3.5px;
        }

        .link-extension--active {
            stroke-opacity: .6;
        }

    #circle_lightgray {
        width: 10px;
        height: 10px;
        -webkit-border-radius: 5px;
        -moz-border-radius: 5px;
        border-radius: 5px;
        background: LightGray;
    }
    #circle_darkgray {
        width: 10px;
        height: 10px;
        -webkit-border-radius: 5px;
        -moz-border-radius: 5px;
        border-radius: 5px;
        background: DarkGray;
    }
    #circle_gray {
        width: 10px;
        height: 10px;
        -webkit-border-radius: 5px;
        -moz-border-radius: 5px;
        border-radius: 5px;
        background: Gray;
    }
    #circle_black {
        width: 10px;
        height: 10px;
        -webkit-border-radius: 5px;
        -moz-border-radius: 5px;
        border-radius: 5px;
        background: Black;
    }
    .gprot_orange {
      color: orange;
    }

    .gprot_blue {
      color: blue;
    }

    .gprot_red {
      color: red;
    }

    .gprot_black {
      color: black;
    }

    .gprot_green {
      color: forestgreen;
    }
    .graydiv {
        height: 20px;
        width: 350px;
        background: linear-gradient(to right, white 0%, black 100%)
    }
    .alignleft {
      float: left;
      width: 175px;
      text-align: left;
      font-weight: bold;
    }
    .alignright {
        float: right;
        width: 175px;
        text-align: right;
        font-weight: bold;
    }
</style>
<style>
  .col-md-12 img {
    transition: transform 0.3s ease, opacity 0.3s ease; /* Smooth transformation for scaling and opacity */
    opacity: 1; /* Full opacity by default */
  }

  .col-md-12 img:hover {
    transform: scale(1.1); /* Scales the image up on hover */
    opacity: 1; /* Full opacity on hover */
  }

  .col-md-12:hover img {
    opacity: 0.5; /* Reduces opacity of all images when any part of the div is hovered over */
  }

  .col-md-12 img:last-child {
    margin-left: 5px; /* Adds 5px margin to the left of the last image */
  }

  .col-md-12 img:hover {
    opacity: 1 !important; /* Ensures the hovered image stays fully opaque */
  }

  .img-container .tooltip {
    position: absolute;
    background-color: black;
    color: white;
    padding: 5px 10px;
    white-space: nowrap;
    visibility: hidden;
    bottom: 100%; /* Adjust if the tooltip appears too high or low */
    left: 50%;
    transform: translateX(-50%) translateY(-10px); /* Adjust to ensure tooltip does not overlap the image */
    z-index: 100; /* Higher value to ensure it's on top of other elements */
  }

  .img-container:hover .tooltip {
    visibility: visible;
    opacity: 1; /* Ensure it's fully opaque */
    transition: visibility 0s, opacity 0.5s linear; /* Immediate visibility change with smooth opacity transition */
  }

  .expandable {
    cursor: pointer;
}

.hidden {
    display: none;
}
</style>
<style>
    .root { fill: red; }
    .sub { fill: black; }
    text { font-family: sans-serif; }
</style>
{% endblock %}

{% block content %}


<div class='col-md-12'>
    <br />
    <h1 style='text-align:center;'>Welcome to Data Mapper!</h1>
    <br \>
</div>


<!-- ##################################### -->
<!-- #### Download // Upload // Report ### -->
<!-- ##################################### -->

<div class='col-md-12' style="margin-top: 50px;">
  <!-- ################# -->
  <!-- #### Download ### -->
  <!-- ################# -->
  <div class="col-md-3" style="text-align:center;">
  </div>
  <div class="col-md-3 img-container" style="text-align:center;">
    <a href="{% static 'Files/Upload_test.xlsx' %}" download="Upload_test.xlsx">
      <img src="{% static 'home/images/Mapper_Download.png' %}" width="140" height="140">
    </a>
    <br>
    <h4 style='text-align:center;margin-top: 10px;'>Download Template.xlsx</h4>

  </div>
  <!-- ################# -->
  <!-- ####  Upload  ### -->
  <!-- ################# -->
  <div class="col-md-3 img-container" style="text-align:center;">
    <form id="upload-file" name="upload-file" enctype="multipart/form-data" method="POST" action="{% url 'landing_page' %}">
      {% csrf_token %}
      <!-- Hidden file input -->
      <input id="file-input" type="file" name="file" style="display:none;" accept="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet">
      <!-- Image selector -- Upload  -->
      <img id="file-trigger" src="{% if upload_status == 'Success' %}{% static 'home/images/Mapper_Upload_Success.png' %}
      {% elif upload_status == 'Failed' %}{% static 'home/images/Mapper_Upload_Failed.png' %}
      {% else %}
      {% static 'home/images/Mapper_Upload.png' %}
      {% endif %}" alt="file" width="140" height="140" style="cursor:pointer;">
      <br>
      <h4 style='text-align:center;margin-top: 10px;'>Upload Data</h4>
    </form>
  </div>
</div>

<div class='col-md-12' style="margin-top: 50px;">
    <br />
    <h3 style='text-align:center;'>Analyses</h3>
    <br \>
</div>

<div class='col-md-12' style="display: flex; justify-content: center; align-items: center;">
  <div class="img-container">
    <img id="phyloTreeImage" src="{% static 'home/images/phylo_example.png' %}" width="140" height="140">
    <br>
    <h6 style='text-align:center;'>Phylogenetic Tree</h6>
    <!-- <span class="tooltip">Phylogenetic Tree</span> -->
  </div>
  <div class="img-container">
    <img src="{% static 'home/images/cluster_example.png' %}" width="140" height="140" style='margin-left: 5px'>
    <br>
    <h6 style='text-align:center;'>Cluster Analysis</h6>
    <!-- <span class="tooltip">Cluster Analysis</span> -->
  </div>
  <div class="img-container">
    <img src="{% static 'home/images/list_example.png' %}" width="140" height="140" style='margin-left: 5px'>
    <br>
    <h6 style='text-align:center;'>List Plot</h6>
    <!-- <span class="tooltip">List Plot</span> -->
  </div>
  <div class="img-container">
    <img src="{% static 'home/images/heatmap_example.png' %}" width="140" height="140" style='margin-left: 5px'>
    <br>
    <h6 style='text-align:center;'>Heatmap</h6>
    <!-- <span class="tooltip">Heatmap</span> -->
  </div>
</div>


<!-- <div style="padding-top: 5px;">
  Plot label:
    <div class="btn-group" role="group" id="gtp_plus">
        <button id="show" class="btn btn-info active">Show</button>
        <button id="hide" class="btn btn-info">Hide</button>
    </div>
</div> -->


<!-- <div id="plotContainer" class="text-center">
  <br />
  <br />
  <h4>Cluster Plot</h4>
  <br />
  <br />
</div> -->


<!-- ######################## -->
<!-- ###### MODALS ! ######## -->
<!-- ######################## -->

<!-- ################################### -->
<!-- ## Failed to submit correct file ## -->
<!-- ################################### -->

<div class="modal fade" id="uploadFailedModal" tabindex="-1" role="dialog" aria-labelledby="uploadFailedModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title" id="uploadFailedModalLabel">Upload Failed</h5>
              <!-- <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
              </button> -->
          </div>
          <div class="modal-body">
              {{Error_message}}
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
      </div>
  </div>
</div>


<!-- ############################# -->
<!-- ## Totally failed report ! ## -->
<!-- ############################# -->

<div class="modal fade" id="Report_modal_failed" tabindex="-1" role="dialog" aria-labelledby="NoReport-modal-label" aria-hidden="true">
  <div class="modal-dialog" role="document">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title" id="NoReport-modal-label">Report: Failed</h5>
              <!-- <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
              </button> -->
          </div>
          <div class="modal-body">

              <h4 class="expandable">Phylogenetic Tree</h4>
              {% if incorrect_values %}
                  <ul id="sortable" class="hidden">
                    {% for key, value in incorrect_values.items %}
                        <li>Col {{key}}: {{ value }}</li>
                    {% endfor %}
                  </ul>
              {% else %}
                  <p>The value is False.</p>
              {% endif %}
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          </div>
      </div>
  </div>
</div>

<!-- ############# -->
<!-- ## Report! ## -->
<!-- ############# -->

<div class="modal fade" id="Report_modal_success" tabindex="-1" role="dialog" aria-labelledby="Report-modal-label" aria-hidden="true">
  <div class="modal-dialog" role="document">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title" id="Report-modal-label">Report: Successful</h5>
              <!-- <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
              </button> -->
          </div>
          <div class="modal-body">
              Here is your report! Good job!
              All values for the phylo tree are good and ready to something.
          </div>
          <div class="modal-footer">
              <!-- <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button> -->
              <button type="button" class="btn btn-primary" onclick="window.location.href=window.location.href;">Back</button>
              {% if sample_data_json %}
                  <p>There is data!</p>
              {% else %}
                  <p>The value is False.</p>
              {% endif %}
              <form method="POST" action="{% url 'data_mapper_plotrender' %}">
                {% csrf_token %}
                <input type="hidden" name="sample_data" value="{{ sample_data_json }}">
                <input type="hidden" name="Phylogenetic_data" value="{{ Data_Phylogenetic_Tree }}">
                <button type="submit" class="btn btn-primary">Continue</button>
            </form>
          </div>
      </div>
  </div>
</div>

<!-- Phylogenetic Tree Modal -->
<div class="modal fade" id="phyloTreeModal" tabindex="-1" role="dialog" aria-labelledby="phyloTreeModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="phyloTreeModalLabel">Phylogenetic Tree</h5>
      </div>
      <div class="modal-body">
        This is the Phylogenetic Tree modal content.
        <div class="img-container">
          <img src="{% static 'home/images/Modal_tree_example.png' %}" width="300" height="300" style='margin-left: 5px'>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

{% endblock %}


{% block addon_js %}
<script src="{% static 'home/js/d3.min.js' %}"></script>
<script src="{% static 'home/js/nv.d3.min.js' %}"></script>
<script src="{% static 'home/js/saveSvgAsPng.js' %}"></script>
<script src="{% static 'home/js/saveSvg.js' %}"></script>
<script src="{% static 'home/js/phylo_tree.js' %}"></script>
<script src="{% static 'home/js/datamapper.js' %}"></script>
<script>
document.querySelectorAll('.img-container img').forEach(img => {
  img.addEventListener('mouseover', function() {
    this.nextElementSibling.style.visibility = 'visible';
  });
  img.addEventListener('mouseout', function() {
    this.nextElementSibling.style.visibility = 'hidden';
  });
});
</script>

<script>

// document.querySelectorAll('.img-container img').forEach(img => {
//   img.addEventListener('mouseover', function() {
//     this.nextElementSibling.style.visibility = 'visible';
//       });
//       img.addEventListener('mouseout', function() {
//         this.nextElementSibling.style.visibility = 'hidden';
//       });
//     });

  $(document).ready(function() {
      $(".expandable").click(function() {
        $("#sortable").toggleClass("hidden");
      });
  });

  // Function to handle file selection
  function handleFileSelect(event) {
          var fileInput = document.getElementById('file-input');
          // Attach change event listener to handle selected file
          fileInput.addEventListener('change', function(event) {
              // Submit the form with selection of a file
              document.getElementById('upload-file').submit();
          });
          // Trigger the file input
          fileInput.click();
      }
  // Add click event listener to the image to trigger file selection
  document.getElementById('file-trigger').addEventListener('click', handleFileSelect);
  // Add click event listener to the Phylogenetic Tree image
  document.getElementById('phyloTreeImage').addEventListener('click', function() {
      $('#phyloTreeModal').modal('show');
    });


  // Check upload status after form submission
  document.addEventListener('DOMContentLoaded', function() {
      // Check if upload was successful
      if ("{{ upload_status }}" === "Success") {
        // Check if report generation was successful
        var Data_Phylogenetic_Tree = JSON.parse('{{ Data_Phylogenetic_Tree|escapejs }}');
        console.log(Data_Phylogenetic_Tree);
        if (typeof Data_Incorrect_Phylogenetic_Tree !== 'undefined') {
          var Data_Incorrect_Phylogenetic_Tree = JSON.parse('{{ Data_Incorrect_Phylogenetic_Tree|escapejs }}');
          console.log(Data_Incorrect_Phylogenetic_Tree);
        }
        if ("{{ report_status }}" === "Success") {
          $('#Report_modal_success').modal('show');
        } else if ("{{ report_status }}" === "Failed") {
          $('#Report_modal_failed').modal('show');
        }
      } else if ("{{ upload_status }}" === "Failed") {
        // Show the upload failed modal
        $('#uploadFailedModal').modal('show');
      }
    });
</script>


<!-- <script type="text/javascript" charset="utf-8">
    tree_data = {{ tree_dict | safe }};
    tree_options = {{ tree_options | safe }};
    maxLeafNodeLenght = 46;
    conversion = {"Outer1":"#0000FF",
                  "Outer2":"#FF0000",
                  "Outer3":"#000000",
                  "Outer4":"#008000",
                  "Outer5":"#FFA500"};

    $("#UniProtNames").click(function(){
        $("#UniProtNames").addClass("active");
        $("#IUPHARNames").removeClass("active");
        changeLeavesLabels("tree_plot", "UniProt", whole_dict);
        DrawCircles('tree_plot', circles, maxLeafNodeLenght, conversion, true, false);
    });
    $("#IUPHARNames").click(function() {
      $("#UniProtNames_bal").removeClass("active");
      $("#IUPHARNames_bal").addClass("active");
      changeLeavesLabels("tree_plot","IUPHAR", whole_dict);
      // DrawCircles('tree_plot',circles, maxLeafNodeLenght,conversion,true,false);
    });
    draw_tree(tree_data, tree_options);
    // DrawCircles('tree_plot', circles, maxLeafNodeLenght, conversion, true, false);
    $("#tree_plot svg g").first().attr('transform', 'translate(620,650) scale(0.9,0.9) ');
    $("#tree_plot").attr('height', 1210);
    $("#tree_plot").attr('width', 1110);
</script> -->


<!-- <script>
  var heatmap_data = {'5ht1a': {'value1': 10, 'value2': 5, 'value3': 1, 'value4': 3, 'value5': 20},
                      '5ht2a': {'value1': 12, 'value2': 9, 'value3': 6, 'value4': 30, 'value5': 21},
                      '5ht1d': {'value1': 7, 'value2': 8, 'value3': 16, 'value4': 3, 'value5': 1},
                      '5ht1e': {'value1': 5, 'value2': 11, 'value3': 20, 'value4': 23, 'value5': 11},
                      '5ht2b': {'value1': 18, 'value2': 2, 'value3': 9, 'value4': 13, 'value5': 4}
                      };

  var list_data = {{ list_data|safe }};

  var cluster_data = {{ cluster_data|safe }};
  var cluster_plot = "{{ plot_type }}";

  // renderDataVisualization(list_data);
  // simple_heatmap(heatmap_data, 'heatmap_location', 'heatmap_svg', 'Legend Label');
  renderClusterPlot(cluster_data, "#plotContainer", cluster_plot);

  $("#show").click(function() {
      $("#show").addClass("active");
      $("#hide").removeClass("active");
      d3.selectAll(".label").style("opacity", 1);
  });

  $("#hide").click(function() {
      $("#show").removeClass("active");
      $("#hide").addClass("active");
      d3.selectAll(".label").style("opacity", 0);
  });
</script>
  // renderClusterPlot(cluster_data, "#plotContainer", cluster_plot);
</script> -->
{% endblock %}
