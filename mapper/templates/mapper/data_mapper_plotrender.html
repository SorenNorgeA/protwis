{% extends "home/base.html" %}
{% load static %}
{% load humanize %}
{% block addon_css %}
<link rel="stylesheet" href="{% static 'home/css/nv.d3.min.css' %}" type="text/css" />
<link rel="stylesheet" href="{% static 'home/css/nvd3-update.css' %}" type="text/css" />
<link href="{% static 'home/css/bootstrap-responsive.css' %}" rel="stylesheet" media="screen">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/spectrum/1.8.1/spectrum.min.css" />


{% endblock %}

{% block content %}
<style>
    #circle_lightgray {
        width: 10px;
        height: 10px;
        -webkit-border-radius: 5px;
        -moz-border-radius: 5px;
        border-radius: 5px;
        background: LightGray;
    }
    #circle_darkgray {
        width: 10px;
        height: 10px;
        -webkit-border-radius: 5px;
        -moz-border-radius: 5px;
        border-radius: 5px;
        background: DarkGray;
    }
    #circle_gray {
        width: 10px;
        height: 10px;
        -webkit-border-radius: 5px;
        -moz-border-radius: 5px;
        border-radius: 5px;
        background: Gray;
    }
    #circle_black {
        width: 10px;
        height: 10px;
        -webkit-border-radius: 5px;
        -moz-border-radius: 5px;
        border-radius: 5px;
        background: Black;
    }
    .gprot_orange {
      color: orange;
    }

    .gprot_blue {
      color: blue;
    }

    .gprot_red {
      color: red;
    }

    .gprot_black {
      color: black;
    }

    .gprot_green {
      color: forestgreen;
    }
    .graydiv {
        height: 20px;
        width: 350px;
        background: linear-gradient(to right, white 0%, black 100%)
    }
    .svg-container {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .hidden {
        display: none;
    }
  
    .color-picker {
      display: flex;
      align-items: center;
    }
    .color-box {
      width: 20px;
      height: 20px;
      margin-right: 10px;
      border: 1px solid #000;
    }

  /* Style adjustments for better visibility */
  .custom-control-label {
      cursor: pointer;
    }
    .dropdown-menu-listplot {
      background-color: rgba(255, 255, 255, 1); /* Slightly transparent white background */
      max-height: 300px; /* Maximum height of the dropdown menu */
      overflow-y: auto; /* Enable vertical scrolling if needed */
      left: 25%; /* Ensures the dropdown opens to the right */
      top: 50%; /* Adjust this value to align the dropdown vertically in the middle */
      transform: translateY(-50%); /* Center align vertically */
      margin-left: 10px; /* Add some space between the button and the dropdown */
    }
    .dropdown-menu-right-middle {
      left: 75%;
      top: 50%;
      transform: translateY(-50%);
      margin-left: 10px; /* Add some space between the button and the dropdown */
      width: 100px !important;
    }
   
</style>
<div class='col-md-12'>
  <br />
  <h3 style='text-align:center;'>Data Mapper Plots</h3>
  <br \>
</div>

<!-- ### Create the panel tabs ### -->
<ul class="nav nav-tabs">
  {% if Plot_evaluation_json.0 %}
    <li class="{% if first_active_tab == '#tab1' %}active{% endif %}">
      <a href="#tab1" data-toggle="tab">Phylogenetic Tree</a>
    </li>
  {% endif %}
  {% if Plot_evaluation_json.1 %}
    <li class="{% if first_active_tab == '#tab2' %}active{% endif %}">
      <a href="#tab2" data-toggle="tab">Cluster Analysis</a>
    </li>
  {% endif %}
  {% if Plot_evaluation_json.2 %}
    <li class="{% if first_active_tab == '#tab3' %}active{% endif %}">
      <a href="#tab3" data-toggle="tab">List Plot</a>
    </li>
  {% endif %}
  {% if Plot_evaluation_json.3 %}
    <li class="{% if first_active_tab == '#tab4' %}active{% endif %}">
      <a href="#tab4" data-toggle="tab">Heatmap</a>
    </li>
  {% endif %}
</ul>

<!-- ## Tab content ## -->
<div class="tab-content">
  <!-- ## Tab 1 - Phylogenetic Tree ## -->
  {% if Plot_evaluation_json.0 %}
  <div id="tab1" class="tab-pane fade {% if first_active_tab == '#tab1' %}in active{% endif %}">
    <div style="padding-top: 10px; font-size: 11px; white-space: nowrap;">
      <div>
        <div style="padding-top: 5px;">
          Receptor names:
            <div class="btn-group" role="group" id="gtp_plus">
                <button id="UniProtNames" class="btn btn-info active">UniProt</button>
                <button id="IUPHARNames" class="btn btn-info">IUPHAR</button>
            </div>
        </div>
        <br />
        Inner circle colors (TBD):
        <table style="width:30%">
            <tr>
                <td ><div id="circle_lightgray"></div></td>
                <td> < XX </td>
                <td ><div id="circle_darkgray"></div></td>
                <td> < YY </td>
                <td ><div id="circle_gray"></div></td>
                <td> < ZZ </td>
                <td ><div id="circle_black"></div></td>
                <td> ZZ+</td>
            </tr>
        </table>
        <br />
        <div style="float: left; position: relative" class="text-center">
          <b>Features</b> <br />
            <span class="gprot_blue">Feature 1</span>
            <span class="gprot_red">Feature 2</span>
            <span class="gprot_black">Feature 3</span>
            <span class="gprot_green">Feature 4</span>
            <span class="gprot_orange">Feature 5</span>
        </div>
        <div style="float: right;" class="text-center">
          <b>Feature! (from low to high)</b>
          <div class="graydiv"></div>
        </div>
        <div class="row-fluid">
          <div class="span12">
            <div id="tree_plot" class="text-center">
              <h4>Tree Plot (Data Mapper)</h4>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% endif %}
  <!-- ## Tab 2 - Cluster Analysis ## -->
  {% if Plot_evaluation_json.1 %}
    <div id="tab2" class="tab-pane fade {% if first_active_tab == '#tab2' %}in active{% endif %}">
      <div style="padding-top: 10px; font-size: 11px; white-space: nowrap;">
      <div style="padding-top: 5px;">
        Plot label:
          <div class="btn-group" role="group" id="gtp_plus">
              <button id="show" class="btn btn-info active">Show</button>
              <button id="hide" class="btn btn-info">Hide</button>
          </div>
      </div>
      <div id="plotContainer" class="text-center"></div>
      
      </div>
    </div>
  {% endif %}
  <!-- ####################### -->
  <!-- ## Tab 3 - List Plot ## -->
  <!-- ####################### -->
  {% if Plot_evaluation_json.2 %}
    <div id="tab3" class="tab-pane fade {% if first_active_tab == '#tab3' %}in active{% endif %}">
      <div style="padding-top: 10px; font-size: 11px; white-space: nowrap;"></div>
      <!-- ############ -->
      <!-- ## Layout ## -->
      <!-- ############ -->
      <div class="col-md-8" style="margin-top: 30px;">
        <div class="col-md-2" style="margin-left: 10px;margin-right: -40px;">
          <div class="dropdown">
            <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Layout
            </button>
            <div class="dropdown-menu dropdown-menu-listplot" style="margin-left: 50px;" aria-labelledby="dropdownMenuButton">
              <div class="col-md-12" style="width:400px;margin-top: 20px;margin-bottom: 20px;text-align: center;">
                <div class="col-md-6" style="padding-left:0;padding-right:0;">
                  <select id="Layout_Column_Selector" class="form-select" style="height: 30px;width: 180px;font-size: 14px;" aria-label="Default select example">
                  <option value="1" selected>1 column</option>
                  <option value="2">2 columns</option>
                  <option value="3">3 columns</option>
                  <option value="4">4 columns</option>
                </select>
                </div>
                <div class="col-md-6" style="padding-left:0;padding-right:0;">
                    <select id="Layout_Column_Breaker" class="form-select" style="height: 30px;width: 160px;font-size: 14px;" aria-label="Default select example">
                    <option value="Layer1">Layer 1</option>
                    <option value="Layer2">Layer 2</option>
                    <option value="Layer3">Layer 3</option>
                    <option value="Layer4">Layer 4</option>
                    <option value="Custom" selected>Custom</option>
                  </select>
                </div>
              </div>
              <div class="col-md-12" style="text-align: center;">
                <label>Max label number per columns</label>
              </div>
              <div class="col-md-12" style="margin-bottom: 20px;text-align: center;">
                <select id="Layout_Max_Label" class="form-select" style="height: 30px;width: 180px;font-size: 14px;" aria-label="Default select example">
                  <option selected>Auto</option>
                  <option value="Custom">Custom</option>
                </select>
              <input type="number" id="Layout_Max_Label_input" name="Layout_Max_Label_input" step="1" min="1" style="height: 30px;width: 60px;font-size: 14px;">
              </div>
              <div class="col-md-12"  style="padding-top: 10px;text-align: center;font-size: 14px;margin-bottom: 20px;">
                <div class="custom-checkbox">
                  <input type="checkbox" class="custom-control-input" id="toggle-indentation">
                  <label class="custom-control-label" for="toggle-indentation">Level indentation</label>
                </div>
              </div>
              <!-- Render Plot Button -->
              <div class="text-center"  style="margin-bottom: 20px;margin-top: 30px;">
                <button id="RenderLayoutButton_Layout" type="button" class="btn btn-primary" style="font-size: 18px;">Render List</button>
              </div>
            </div>
          </div>
        </div>
        <!-- ################## -->
        <!-- ## Levels Button ## -->
         <!-- ################## -->
        <div class="col-md-2" style="margin-left: 10px;margin-right: -40px;">
          <div class="dropdown" style="width: 100px !important;">
            <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Levels
            </button>
            <div class="dropdown-menu dropdown-menu-listplot" style="left: 60%"  aria-labelledby="dropdownMenuButton">
              <div class="col-md-12" style="text-align: left;font-size: 16px;">Set visible levels
                <div class="col-md-12" style="padding-top: 10px;">
                  <div class="custom-checkbox">
                    <input type="checkbox" class="custom-control-input" id="toggle-layer-1" checked>
                    <label class="custom-control-label" for="toggle-layer-1" style="margin-left: 5px;font-size: 16px;">Display Class</label>
                  </div>
                </div>
                <div class="col-md-12"  style="padding-top: 10px;">
                  <div class="custom-checkbox">
                    <input type="checkbox" class="custom-control-input" id="toggle-layer-2" checked>
                    <label class="custom-control-label" for="toggle-layer-2">Display ligand type</label>
                  </div>
                </div>
                <div class="col-md-12"  style="padding-top: 10px;">
                  <div class="custom-checkbox">
                    <input type="checkbox" class="custom-control-input" id="toggle-layer-3" checked>
                    <label class="custom-control-label" for="toggle-layer-3">Display receptor family</label>
                  </div>
                </div>
                <!-- <div class="col-md-12"  style="padding-top: 10px;">
                  <div class="custom-checkbox">
                    <input type="checkbox" class="custom-control-input" id="toggle-layer-4" checked>
                    <label class="custom-control-label" for="toggle-layer-4">Display receptor</label>
                  </div>
                </div> -->
              </div>
            </div>
          </div>
        </div>
        
        <!-- ############### -->
        <!-- ### Label Styling ###  -->
         <!-- ############### -->
        <div class="col-md-2" style="margin-left: 10px;margin-right: -10px;">
          <div class="dropdown" style="width: 400px !important;">
            <button class="btn btn-primary dropdown-toggle" type="button" id="Styling_Menu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Label Styling
            </button>
            <div class="dropdown-menu dropdown-menu-listplot" aria-labelledby="Styling_Menu">
              <!-- Layer Selector Dropdown -->
              <div class="col-md-12" style="width:300px;margin-top: 20px;margin-bottom: 20px;">
                <div class="col-md-6" style="padding-left:0;padding-right:0;">
                  <select id="Styling_layerSelector" class="form-select" style="height: 30px;width: 120px;font-size: 14px;" aria-label="Default select example" onchange="updateMax()">
                    <option value="Layer1" selected>Class</option>
                    <option value="Layer2">Ligand type</option>
                    <option value="Layer3">Receptor family</option>
                    <option value="Layer4">Receptor</option>
                  </select>
                </div>
          
                <!-- Color Selector Dropdown -->
                <div class="col-md-6">
                  <div class="color-picker">
                    <input type="text" id="colorPicker_LabelStyling"/>
                  </div>
                </div>
              </div>
              <div class="col-md-12" style="width:300px;margin-top: 20px;margin-bottom: 20px;">
                <!-- Bold Checkbox -->
                <div class="form-check col-md-4" style="padding-left:0;padding-right:0;">
                  <input class="form-check-input" type="checkbox" value="" id="boldCheckbox">
                  <label class="form-check-label" for="boldCheckbox">
                    Bold
                  </label>
                </div>
        
                <!-- Italic Checkbox -->
                <div class="form-check col-md-4" style="padding-left:0;padding-right:0;">
                  <input class="form-check-input" type="checkbox" value="" id="italicCheckbox">
                  <label class="form-check-label" for="italicCheckbox">
                    Italic
                  </label>
                </div>
        
                <!-- Underline Checkbox -->
                <div class="form-check col-md-4" style="padding-left:0;padding-right:0;">
                  <input class="form-check-input" type="checkbox" value="" id="underlineCheckbox">
                  <label class="form-check-label" for="underlineCheckbox">
                    Underline
                  </label>
                </div>
              </div>
              <!-- Font Size Slider -->
              <div class="col-md-12" style="text-align: center;">
                <label for="fontSizeSliderValue" id="fontSizeSliderLabel" class="form-label">Font Size: 16px</label>
              </div>
              <div class="col-md-12" style="margin-bottom: 30px;">  
                <input type="range" class="form-range" min="8" max="32" id="fontSizeSlider">
              </div>
              <!-- Render Plot Button -->
              <div class="text-center" style="margin-bottom: 20px;">
                <button id="renderPlotButton" type="button" class="btn btn-primary" style="font-size: 18px;">Render List</button>
              </div>
            </div>
          </div>
        </div>
        <!-- ##################### -->
        <!-- ##  Data styling   ## -->
        <!-- ##################### -->
        <div class="col-md-2" style="margin-left: 20px;margin-right: -20px;">
          <div class="dropdown" style="width: 450px !important;">
            <button class="btn btn-primary dropdown-toggle" type="button" id="Data_Styling_Menu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              Data Styling
            </button>
            <div class="dropdown-menu dropdown-menu-listplot" style="margin-left: -8px;" aria-labelledby="Data_Styling_Menu">
              <!-- Data Selector Dropdown -->
              <div class="col-md-12" style="width:400px;margin-top: 20px;margin-bottom: 10px;">
                <div class="col-md-6" style="padding-left:0;padding-right:0;">
                  <select id="Data_Styling_Selector" class="form-select" style="height: 35px;width: 130px;font-size: 14px;" onchange="updateColorComplexityDropdown()">
                    <option value="Select Data" selected>Select Data</option>
                  </select>
                </div>
                <div class="col-md-6" style="padding-left:0;padding-right:0;margin-left: -20px;">
                </div>
              </div>
              <div class="col-md-12" style="width:400px;margin-top: 10px;margin-bottom: 10px;">
                <div class="col-md-6" style="padding-left:0;padding-right:0;">
                  <select id="ColorComplexityDropdown" style="display: none;height: 35px;width: 130px;font-size: 14px;" onchange="updateColorDropdowns()">
                    <option value="One" selected>One Color</option>
                    <option value="Two">Two Colors</option>
                  </select>
                </div>
                <div class="col-md-6" style="padding-left:0;padding-right:0;margin-left: -20px;">
                  <div class="color-picker" id="OneColor_DataStyling_container" style="display: none;height: 35px;width: 130px;font-size: 14px;">
                    <input type="text" id="OneColor_DataStyling"/>
                  </div>
                </div>
                <div class="col-md-6" style="padding-left:0;padding-right:0;">
                  <div class="col-md-3" style="padding-left:0;padding-right:0px;margin-left: -20px;margin-right: 20px;">
                    <div class="color-picker" id="TwoColor_DataStyling_One_container" style="display: none;height: 35px;width: 130px;font-size: 14px;">
                      <input type="text" id="TwoColor_DataStyling_one"/>
                    </div>
                  </div>
                  <div class="col-md-3" style="padding-left:0;padding-right:0;margin-left: 20px;">
                    <div class="color-picker" id="TwoColor_DataStyling_Two_container" style="display: none;height: 35px;width: 130px;font-size: 14px;">
                      <input type="text" id="TwoColor_DataStyling_two"/>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-12" style="width:400px;margin-top: 15px;margin-bottom: 15px;">
                <!-- Render Plot Button -->
                <div class="text-center" style="margin-bottom: 15px;">
                  <button id="DataStyling_renderPlotButton" type="button" class="btn btn-primary" style="font-size: 18px;" disabled>Render List</button>
                </div>
              </div>    
            </div>
          </div>
        </div>

        <!-- ##################### -->
        <!-- ## Download button ## -->
        <!-- ##################### -->
        </div>
        <div class="col-md-1" style="margin-top: 30px;"></div>
        <div class="col-md-3" style="margin-top: 30px;">
        <div class="col-md-3">
          <div class="text-center">
            <div class="dropdown">
              <button type="button" class="btn btn-primary dropdown-toggle" style="font-size: 14px;" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class="glyphicon glyphicon-download" style="vertical-align: top;line-height: 1.3"></span> Download <span class="caret"></span>
              </button>
              <div class="dropdown-menu dropdown-menu-right-middle">
                <li><a class="dropdown-item" href="javascript:saveSvg(document.getElementById('ListPlot_visualization'), 'DataVisualization.svg');">SVG</a></li>
                <li><a class="dropdown-item" href="javascript:saveSvgAsPng(document.getElementById('ListPlot_visualization'), 'DataVisualization.png');">PNG</a></li>
                <li><a class="dropdown-item" href="javascript:saveSvgAsJpg(document.getElementById('ListPlot_visualization'), 'DataVisualization.jpg');">JPG</a></li>
                <li><a class="dropdown-item" href="javascript:saveSvgAsTiff(document.getElementById('ListPlot_visualization'), 'DataVisualization.tiff');">TIFF</a></li>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- Receptor label switch -->
      <div class="col-md-12" style="margin-top: 20px;">
        <div>
          Receptor names:
            <div class="btn-group" role="group" id="gtp_plus">
                <button id="List_UniProtNames" class="btn btn-info">UniProt</button>
                <button id="List_IUPHARNames" class="btn btn-info active">IUPHAR</button>
            </div>
        </div>
      </div>
      <div id="ListPlot" class="text-left" style="margin-top: 120px;"></div>
    </div>

  {% endif %}
  <!-- ##################### -->
  <!-- ## Tab 4 - Heatmap ## -->
  <!-- ##################### -->
  {% if Plot_evaluation_json.3 %}
    <div id="tab4" class="tab-pane fade {% if first_active_tab == '#tab4' %}in active{% endif %}">
      <div style="padding-top: 10px; font-size: 11px; white-space: nowrap;"></div>
      <!-- Receptor label switch -->
      <div class="col-md-12" style="margin-top: 20px;">
        <div>
          Receptor names:
            <div class="btn-group" role="group" id="gtp_plus">
                <button id="Heatmap_UniProtNames" class="btn btn-info active">UniProt</button>
                <button id="Heatmap_IUPHARNames" class="btn btn-info">IUPHAR</button>
            </div>
        </div>
      </div>
      <div class="col-md-12" style="margin-top: 20px;margin-bottom: 30px;">
        <div class="col-md-2">
        <div class="dropdown" style="width: 500px !important;">
          <button class="btn btn-primary dropdown-toggle" type="button" id="Styling_Menu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Color styling
          </button>
          <div class="dropdown-menu dropdown-menu-listplot" aria-labelledby="Styling_Menu">
            <!-- Color complexity Dropdown -->
            <div class="col-md-12" style="width:400px;margin-top: 20px;margin-bottom: 20px;">
              <div class="col-md-6" style="width:150px;margin-right: 20px;">
                <select id="Heatmap_color_styling" class="form-select" style="height: 30px;width: 150px;font-size: 14px;" aria-label="Default select example" onchange="UpdateColorPickers()">
                  <option value="One" selected>One color</option>
                  <option value="Two">Two colors</option>
                  <option value="Three">Three colors</option>
                </select>
              </div>
        
              <!-- Color Selector Dropdown -->
              <div class="col-md-6" style="height: 15px;width: 200px;">
                  <div class="col-md-3" id="Heatmap_Color_min_container" style="display: none;width: 80px;margin-left: 0px;margin-right: 0px;">
                    <input type="text" id="Heatmap_colorPicker_min" />
                  </div>
                <!-- Color Selector Dropdown -->
                  <div class="col-md-3" id="Heatmap_Color_max_container" style="width: 80px;margin-left: 0px;margin-right: 0px;">
                    <input type="text" id="Heatmap_colorPicker_max"/>
                  </div>
              </div>
            </div>
            <!-- Set Colors Buttons -->
            <div class="text-center" style="margin-bottom: 15px;">
              <div class="col-md-12" style="margin-bottom: 5px;">
                <div class="col-md-6"><button id="GrayScale" type="button" class="btn btn-primary" style="width:150px;font-size: 14px;">Grey scale</button></div>
                <div class="col-md-6"><button id="GrayBlueScale" type="button" class="btn btn-primary" style="width:150px;font-size: 14px;">Grey-Blue scale</button></div>
              </div>
              <div class="col-md-12">
                <div class="col-md-6"><button id="RedBlueScale" type="button" class="btn btn-primary" style="width:150px;font-size: 14px; margin-right: 10px;">Red-Blue Scale</button></div>
                <div class="col-md-6"><button id="TealMagentaScale" type="button" class="btn btn-primary" style="width:150px;font-size: 14px; margin-right: 10px;">Teal-Magenta Scale</button></div>
              </div>
            </div>
            <!-- Render button -->
            <div class="col-md-12" style="width:400px;margin-top: 15px;margin-bottom: 15px;text-align: center;">
              <!-- Render Plot Button -->
              <div class="text-center" style="margin-bottom: 15px;">
                <button id="RenderHeatmap_colering" type="button" class="btn btn-primary" style="font-size: 18px;">Render Heatmap</button>
              </div>
            </div>    
          </div>
        </div>
      </div>
      <div class="col-md-2">
      <div class="dropdown" style="width: 400px !important;">
        <button class="btn btn-primary dropdown-toggle" type="button" id="Styling_Menu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Label styling
        </button>
        <div class="dropdown-menu dropdown-menu-listplot" aria-labelledby="Styling_Menu">
          <!-- label styling Dropdown -->
          <div class="col-md-12" style="width:300px;margin-top: 20px;margin-bottom: 20px;">
            <div class="col-md-6" style="padding-left:0;padding-right:0;">Label orientation
              <select id="Heatmap_xlabel_styling" class="form-select" style="height: 30px;width: 120px;font-size: 14px;" aria-label="Default select example">
                <option value="0" selected>Horizontal</option>
                <!-- <option value="45">45 degrees</option> -->
                <option value="90">Vertical</option>
              </select>
            </div>
            <div class="col-md-6" style="padding-left:0;padding-right:0;">Label Position
              <select id="Heatmap_xlabel_position" class="form-select" style="height: 30px;width: 120px;font-size: 14px;" aria-label="Default select example">
                <option value="Bottom" selected>Bottom</option>
                <option value="Top">Top</option>
              </select>
            </div>
          </div>
           <!-- Label Font Size Slider -->
           <div class="col-md-12" style="text-align: center;">
            <label for="Heatmap_fontSizeSliderValue" id="Heatmap_fontSizeSliderLabel" class="form-label">Label Font Size: 14px</label>
          </div>
          <div class="col-md-12" style="margin-bottom: 30px;">  
            <input type="range" class="form-range" min="10" max="16" id="Heatmap_fontSizeSlider" value="14">
          </div>

          <!-- Receptor Font Size Slider -->
          <div class="col-md-12" style="text-align: center;">
            <label for="Heatmap_receptor_fontSizeSliderValue" id="Heatmap_receptor_fontSizeSliderLabel" class="form-label">Receptor Font Size: 14px</label>
          </div>
          <div class="col-md-12" style="margin-bottom: 30px;">  
            <input type="range" class="form-range" min="8" max="15" id="Heatmap_receptor_fontSizeSlider" value="14">
          </div>

          <!-- Render button -->
          <div class="col-md-12" style="width:300px;margin-top: 15px;margin-bottom: 15px;">
            <!-- Render Plot Button -->
            <div class="text-center" style="margin-bottom: 15px;">
              <button id="RenderHeatmap_labels" type="button" class="btn btn-primary" style="font-size: 18px;">Render Heatmap</button>
            </div>
          </div>    
        </div>
        </div>
      </div>
      <div class="col-md-2">
        <div>
          <button id="Heatmap_data_labels" class="btn btn-success dropdown-toggle active">Data Labels</button>
      </div>
      </div>
      <div class="col-md-2">
        <div class="dropdown" style="width: 400px !important;">
          <button class="btn btn-primary dropdown-toggle" type="button" id="Heatmap_DataStyling_Menu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Data styling
          </button>
          <div class="dropdown-menu dropdown-menu-listplot" aria-labelledby="Heatmap_DataStyling_Menu">
            <!-- Layer Selector Dropdown -->
            <div class="col-md-12" style="width:300px;margin-top: 20px;margin-bottom: 20px;">
              <div class="col-md-6" style="padding-left:0;padding-right:0;">Data border
                <select id="Heatmap_Border_Styling" class="form-select" style="height: 30px;width: 120px;font-size: 14px;" aria-label="Default select example">
                  <option value="Yes" selected>Yes</option>
                  <option value="No" >No</option>
                </select>
              </div>
            </div>
            <!-- Data Font Size Slider -->
            <div class="col-md-12" style="text-align: center;">
              <label for="Heatmap_data_fontSizeSliderValue" id="Heatmap_data_fontSizeSliderLabel" class="form-label">Data Label Font Size: 12px</label>
            </div>
            <div class="col-md-12" style="margin-bottom: 30px;">  
              <input type="range" class="form-range" min="8" max="16" id="Heatmap_data_fontSizeSlider" value="12">
            </div>
            <!-- Render button -->
            <div class="col-md-12" style="width:300px;margin-top: 15px;margin-bottom: 15px;">
              <!-- Render Plot Button -->
              <div class="text-center" style="margin-bottom: 15px;">
                <button id="RenderHeatmap_DataStyling" type="button" class="btn btn-primary" style="font-size: 18px;">Render Heatmap</button>
              </div>
            </div>    
          </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="text-center">
            <div class="dropdown">
              <button type="button" class="btn btn-primary dropdown-toggle" style="font-size: 14px;" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <span class="glyphicon glyphicon-download" style="vertical-align: top;line-height: 1.3"></span> Download <span class="caret"></span>
              </button>
              <div class="dropdown-menu dropdown-menu-right-middle">
                <li><a class="dropdown-item" href="javascript:saveSvg(document.getElementById('Heatmap_plot'), 'Heatmap.svg');">SVG</a></li>
                <li><a class="dropdown-item" href="javascript:saveSvgAsPng(document.getElementById('Heatmap_plot'), 'Heatmap.png');">PNG</a></li>
                <li><a class="dropdown-item" href="javascript:saveSvgAsJpg(document.getElementById('Heatmap_plot'), 'Heatmap.jpg');">JPG</a></li>
                <li><a class="dropdown-item" href="javascript:saveSvgAsTiff(document.getElementById('Heatmap_plot'), 'Heatmap.tiff');">TIFF</a></li>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id="heatmapPlot" class="text-center" style="margin-left: -150px;"></div>
      </div>
    </div>
    </div>
  {% endif %}
</div>

{% endblock %}

{% block addon_js %}
<script src="{% static 'home/js/d3.min.js' %}"></script>
<script src="{% static 'home/js/nv.d3.min.js' %}"></script>
<script src="{% static 'home/js/saveSvgAsPng.js' %}"></script>
<script src="{% static 'home/js/saveSvg.js' %}"></script>
<script src="{% static 'home/js/phylo_tree.js' %}"></script>
<script src="{% static 'home/js/datamapper.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/spectrum/1.8.1/spectrum.min.js"></script>

<!-- ################## -->
<!-- ###    Tree    ### -->
<!-- ################## -->
{% if Plot_evaluation_json.0 %}
  <script type="text/javascript" charset="utf-8">
      tree_data = {{ tree | safe }};
      tree_options = {{ tree_options | safe }};
      circles = {{ circles|safe }};
      whole_dict = {{ whole_dict|safe }};
      maxLeafNodeLenght = 55;
      conversion = {"Outer1":"#0000FF",
                    "Outer2":"#FF0000",
                    "Outer3":"#000000",
                    "Outer4":"#008000",
                    "Outer5":"#FFA500"};

      $("#UniProtNames").click(function(){
          $("#UniProtNames").addClass("active");
          $("#IUPHARNames").removeClass("active");
          changeLeavesLabels("tree_plot", "UniProt", whole_dict);
          DrawCircles('tree_plot', circles, maxLeafNodeLenght, conversion, true, false);
      });
      $("#IUPHARNames").click(function() {
        $("#UniProtNames_bal").removeClass("active");
        $("#IUPHARNames_bal").addClass("active");
        changeLeavesLabels("tree_plot","IUPHAR", whole_dict);
        // DrawCircles('tree_plot',circles, maxLeafNodeLenght,conversion,true,false);
      });
      draw_tree(tree_data, tree_options);
      DrawCircles('tree_plot', circles, maxLeafNodeLenght, conversion, true, false);
      $("#tree_plot svg g").first().attr('transform', 'translate(620,650) scale(0.8,0.8) ');
      $("#tree_plot").attr('height', 110);
      $("#tree_plot").attr('width', 1110);

  </script>
{% endif %}

<!-- ################## -->
<!-- ###  Cluster   ### -->
<!-- ################## -->
{% if Plot_evaluation_json.1 %}
<script>
$(document).ready(function() {
    var cluster_data = {{ cluster_data|safe }};
    var cluster_plot = "{{ plot_type }}";
    renderClusterPlot(cluster_data, "#plotContainer", cluster_plot);

    $("#show").click(function() {
        $("#show").addClass("active");
        $("#hide").removeClass("active");
        d3.selectAll(".label").style("opacity", 1);
    });

    $("#hide").click(function() {
        $("#show").removeClass("active");
        $("#hide").addClass("active");
        d3.selectAll(".label").style("opacity", 0);
    });
});

</script>
{% endif %}

<!-- ################## -->
<!-- ###    List    ### -->
<!-- ################## -->

{% if Plot_evaluation_json.2 %}

  <script>
    $(document).ready(function() {
      // Function to initialize Spectrum color picker
      function initializeColorPicker(elementId) {
        $("#" + elementId).spectrum({
          color: "#000",
          showPalette: true,
          showInput: true,
          preferredFormat: "hex",
          palette: [
            ["#000", "#FF0000", "#00FF00", "#0000FF", "#FFFF00"],
            ["#FF00FF", "#00FFFF", "#FFFFFF", "#C0C0C0", "#808080"],
            ["#800000", "#808000", "#008000", "#800080", "#008080"],
            ["#000080"]
          ],
          change: function(color) {
            var selectedColor = color.toHexString();
          }
        });
      }
      // Initialize all color pickers
      initializeColorPicker("colorPicker_LabelStyling");
      initializeColorPicker("OneColor_DataStyling");
      initializeColorPicker("TwoColor_DataStyling_one");
      initializeColorPicker("TwoColor_DataStyling_two");
    });
  </script>

<script>

// #####################
// # Load view context #
// #####################

var listdata = {{ listplot_data|safe }};
var list_data_wow = {{ listplot_data_variables|safe }};
var data_types = {{listplot_datatypes|safe}};
var Label_conversion_dict = {{Label_Conversion|safe}};

// #################################
// ## Initialize global variables ##
// #################################


// # Initialize layout #
var Layout_dict = {columns: 2, col_breaker: 'Custom', col_max_label: 'Auto'};

//  Initialize styling 
var Styling_Option_dict = {
    Layer1: {Bold: true, Italic: true, Underline: true, Fontsize: "20px", Color: "#000"},
    Layer2: {Bold: true, Italic: true, Underline: false, Fontsize: "18px", Color: "#0000FF"},
    Layer3: {Bold: true, Italic: false, Underline: false, Fontsize: "16px", Color: "#FF0000"},
    Layer4: {Bold: false, Italic: true, Underline: false, Fontsize: "14px", Color: "#000"}};

// # Initialize label switcher #
var Label_names = 'IUPHAR';

// # Initialize data styling #
var Data_styling = initializeDataStyling(list_data_wow, data_types);
    

// #################################
// # Initialize data visualization #
// #################################

document.addEventListener("DOMContentLoaded", function() {


  renderDataVisualization(listdata, 'ListPlot',Styling_Option_dict,Layout_dict,Data_styling,Label_conversion_dict,Label_names);

  // Data styling render button functionality *** Add for the other buttons! ***
  const renderPlotButton_dataStyling = document.querySelector('#DataStyling_renderPlotButton');
  const dataStylingSelector = document.querySelector('#Data_Styling_Selector');

  // Add event listeners to the dropdowns to check their values
  dataStylingSelector.addEventListener('change', checkDropdownValues);

  function checkDropdownValues() {
    const dataStylingValue = dataStylingSelector.value;
    const dataTypeValue = ColorComplexityDropdown.value;

    // Enable the button if both dropdowns have valid values
    if (dataStylingValue !== 'Select Data') {
      renderPlotButton_dataStyling.disabled = false;
    } else {
      renderPlotButton_dataStyling.disabled = true;
    }
  }
});

// Function to update the visualization
function updateVisualization() {
      // Clear existing SVG content
      d3.select("#ListPlot_visualization").remove();
      // Re-render the visualization
      renderDataVisualization(listdata, "ListPlot",Styling_Option_dict,Layout_dict,Data_styling,Label_conversion_dict,Label_names);
    }

// Add event listeners to checkboxes
d3.selectAll('input[type="checkbox"]').on("change", updateVisualization);

$('.dropdown-menu').on('click', function(event){
    event.stopPropagation();
  });

// Update the font size label based on slider value
const fontSizeSlider = document.getElementById('fontSizeSlider');
const fontSizeLabel = document.getElementById('fontSizeSliderLabel');
fontSizeSlider.addEventListener('input', () => {
  fontSizeLabel.textContent = `Font Size: ${fontSizeSlider.value}px`;
});

// #####################
// ## Layout options  ##
// #####################

// Select the Render Plot button
const renderPlotButton_Layout = document.querySelector('#RenderLayoutButton_Layout');

// Add click event listener to the button
renderPlotButton_Layout.addEventListener('click', function() {
  
  // Select the layer selector dropdown
  const layerSelector_layout = document.querySelector('#Layout_Column_Selector');
  const layerBreaker_layout = document.querySelector('#Layout_Column_Breaker');
  
  // Get the selected layer value
  const Layout_selectedLayer = layerSelector_layout.value;
  const Layout_selectedLayerBreaker = layerBreaker_layout.value;

  // Update function
  function UpdateLayout() {
      // Get values 
      
      const Cols = parseInt(document.querySelector("#Layout_Column_Selector").value);
      const LayerBreak = document.querySelector("#Layout_Column_Breaker").value;
      const Max_label_selector = document.querySelector("#Layout_Max_Label").value;
      const Max_label_number = parseInt(document.querySelector("#Layout_Max_Label_input").value);

      // Handle Max label number
      if (Max_label_selector == 'Auto') {
        Layout_dict.col_max_label = 'Auto';
      } else if (Max_label_selector == 'Custom'){
        Layout_dict.col_max_label = 'Custom';
        Layout_dict.Col_break_number = Max_label_number;
      }
      
      // update values
      Layout_dict.columns = Cols;
      Layout_dict.col_breaker = LayerBreak;
      // Update plot
      updateVisualization();
  }

  // Check if the selected layer is "Select Layer"
  if (Layout_selectedLayer === "Select Column Number" || Layout_selectedLayerBreaker === "Select Layer Beaker") {
    if (Layout_selectedLayer === "Select Column Number" && Layout_selectedLayerBreaker === "Select Layer Beaker") {
      alert("You need to select both a number of columns and select a layer that breaks the columns.");
      return;
    } else if (Layout_selectedLayer === "Select Column Number") {
      alert("You need to select a number of columns.");
      return;
    }  else if (Layout_selectedLayerBreaker === "Select Layer Beaker") {
      alert("You need to select a layer that breaks the columns.");
      return;
    }
  } else {
    UpdateLayout()
  }
});


// #####################
// ## Styling options ##
// #####################

// Select the Render Plot button
const renderPlotButton = document.querySelector('#renderPlotButton');

// Add click event listener to the button
renderPlotButton.addEventListener('click', function() {
  // Select the layer selector dropdown
  const layerSelector = document.querySelector('#Styling_layerSelector');

  // Get the selected layer value
  const selectedLayer = layerSelector.value;

  // Update function
  function UpdateLayer(selectedLayer) {
      // Get values 
      const boldCheckbox = document.getElementById("boldCheckbox").checked
      const italicCheckbox = document.getElementById("italicCheckbox").checked
      const underlineCheckbox = document.getElementById("underlineCheckbox").checked
      const fontsizeslider = `${document.getElementById("fontSizeSlider").value}px`
      // const color = document.querySelector("#Styling_colors").value;
      const colorPicker_LabelStyling = document.getElementById("colorPicker_LabelStyling");

      // update values
      Styling_Option_dict[selectedLayer].Bold = boldCheckbox;
      Styling_Option_dict[selectedLayer].Italic = italicCheckbox;
      Styling_Option_dict[selectedLayer].Underline = underlineCheckbox;
      Styling_Option_dict[selectedLayer].Fontsize = fontsizeslider;
      
      // Get the selected color from the Spectrum color picker
      const One_Color_value = $(colorPicker_LabelStyling).spectrum("get").toHexString();

      Styling_Option_dict[selectedLayer].Color = One_Color_value;
      
      // Update plot
      updateVisualization();
  }
  // Check if the selected layer is "Select Layer"
  if (selectedLayer === "Select Layer") {
    alert("No Layer has been selected");
    return;
  } else {
    if (selectedLayer === "Layer1" || selectedLayer === "Layer2" || selectedLayer === "Layer3" || selectedLayer === "Layer4") {
      UpdateLayer(selectedLayer);
    }
  }
});

function updateMax() {
    var layerSelector = document.getElementById("Styling_layerSelector");
    var fontSizeSlider = document.getElementById("fontSizeSlider");

    if (layerSelector.value === "Layer3") {
        fontSizeSlider.max = 16;
    } else if ((layerSelector.value === "Layer2")) {
      fontSizeSlider.max = 24;
    } else if ((layerSelector.value === "Layer4")) {
      fontSizeSlider.max = 23;
    } else {
        // Reset to default max value
        fontSizeSlider.max = 28;
    }
  }

// ####################
// ## Update styling ##
// ####################

// Get the layer selector dropdown element
const layerSelector = document.getElementById("Styling_layerSelector");

// Add event listener to the layer selector dropdown
layerSelector.addEventListener("change", function() {
    // Get the selected layer value
    const selectedLayer = layerSelector.value;

    // Get the styling options for the selected layer from the styling dictionary
    const selectedLayerStyling = Styling_Option_dict[selectedLayer];

    // Update the UI elements based on the selected layer's styling options
    document.getElementById("boldCheckbox").checked = selectedLayerStyling.Bold;
    document.getElementById("italicCheckbox").checked = selectedLayerStyling.Italic;
    document.getElementById("underlineCheckbox").checked = selectedLayerStyling.Underline;
    document.getElementById("fontSizeSlider").value = parseInt(selectedLayerStyling.Fontsize);
    
    // Update the label for font size slider
    document.getElementById("fontSizeSliderLabel").textContent = "Font Size: " + selectedLayerStyling.Fontsize;

    // Set the selected color in the Spectrum color picker
    const colorPicker_LabelStyling = document.getElementById("colorPicker_LabelStyling");
    $(colorPicker_LabelStyling).spectrum("set", selectedLayerStyling.Color);
  });
  
// ###################
// ## Data styling ##
// ###################

// Function to populate select options based on Data_styling
function populateSelectOptions() {
  var select = document.getElementById("Data_Styling_Selector");
  
  // Clear existing options
  select.innerHTML = '<option selected>Select Data</option>';

  // Loop through Data_styling and add options for columns with Data: "Yes"
  Object.keys(Data_styling).forEach(function(column) {
    if (Data_styling[column].Data === "Yes" && Data_styling[column].Datatype == 'Continuous') {
      var option = document.createElement("option");
      option.value = column;
      option.textContent = "Data Column " + column.substr(3); // Extract number from column name
      select.appendChild(option);
    }
  });
}

// Call the function to populate options initially
populateSelectOptions();

  
// Function to update the Datatypes dropdown based on selected data column
function updateColorComplexityDropdown() {
  var dataColumn = document.getElementById("Data_Styling_Selector");
  // var DataColoringDropdown = document.getElementById("DataColoringDropdown")
  var ColorComplexityDropdown = document.getElementById("ColorComplexityDropdown");
  var OneColor_DataStyling = document.getElementById("OneColor_DataStyling_container");
  var TwoColor_DataStyling_One = document.getElementById("TwoColor_DataStyling_One_container");
  var TwoColor_DataStyling_two = document.getElementById("TwoColor_DataStyling_Two_container");

  const dataColumn_value = dataColumn.value;
  const ColorComplexity_value = ColorComplexityDropdown.value;

  if (dataColumn_value === 'Select Data') {
    // Show the dropdown
    ColorComplexityDropdown.style.display = "None";
    // DataColoringDropdown.style.display = "None"
    OneColor_DataStyling.style.display = 'None';
    TwoColor_DataStyling_One.style.display = 'None';
    TwoColor_DataStyling_two.style.display = 'None';
  } else {
    // Hide the dropdown if no Datatypes or if Data.Data !== Yes
    ColorComplexityDropdown.style.display = "Block";
    // DataColoringDropdown.style.display = "Block"
    if (ColorComplexity_value == 'One') {
      OneColor_DataStyling.style.display = 'Block';
    } else {
      TwoColor_DataStyling_One.style.display = 'Block';
      TwoColor_DataStyling_two.style.display = 'Block';
    }
  }
}

function updateColorDropdowns() {
  var ColorComplexityDropdown = document.getElementById("ColorComplexityDropdown");
  var OneColor_DataStyling = document.getElementById("OneColor_DataStyling_container");
  var TwoColor_DataStyling_One = document.getElementById("TwoColor_DataStyling_One_container");
  var TwoColor_DataStyling_two = document.getElementById("TwoColor_DataStyling_Two_container");

  const ColorComplexity_value = ColorComplexityDropdown.value;

  if (ColorComplexity_value == 'One') {
    OneColor_DataStyling.style.display = 'Block';
    TwoColor_DataStyling_One.style.display = 'None';
    TwoColor_DataStyling_two.style.display = 'None';
  } else {
    OneColor_DataStyling.style.display = 'None';
    TwoColor_DataStyling_One.style.display = 'Block';
    TwoColor_DataStyling_two.style.display = 'Block';
  }
}

// Select the Render Plot button
const renderPlotButton_dataStyling = document.querySelector('#DataStyling_renderPlotButton');
// Add click event listener to the button
renderPlotButton_dataStyling.addEventListener('click', function() {

  // Select the layer selector dropdown
  const Selector_DataStyling = document.querySelector('#Data_Styling_Selector');
  // const DataColoringDropdown = document.getElementById("DataColoringDropdown")
  const ColorComplexityDropdown = document.getElementById("ColorComplexityDropdown");
  const OneColor_DataStyling = document.getElementById("OneColor_DataStyling");
  const TwoColor_DataStyling_One = document.getElementById("TwoColor_DataStyling_one");
  const TwoColor_DataStyling_two = document.getElementById("TwoColor_DataStyling_two");
  
  const colorPicker_LabelStyling = document.getElementById("colorPicker_LabelStyling");
  // Get the selected layer value
  const Selector_DataStyling_value = Selector_DataStyling.value;
  // const Data_coloring_value = DataColoringDropdown.value;
  const Color_complexity_value = ColorComplexityDropdown.value;


  if (Color_complexity_value == 'One') {
    const One_Color_value = $(OneColor_DataStyling).spectrum("get").toHexString();
    Data_styling[Selector_DataStyling_value].Data_color1 = One_Color_value;
    Data_styling[Selector_DataStyling_value].data_color_complexity = Color_complexity_value;
  } else if (Color_complexity_value == 'Two') {
    const Two_Color_value_one = $(TwoColor_DataStyling_One).spectrum("get").toHexString();
    const Two_Color_value_two = $(TwoColor_DataStyling_two).spectrum("get").toHexString();
    Data_styling[Selector_DataStyling_value].Data_color1 = Two_Color_value_one;
    Data_styling[Selector_DataStyling_value].Data_color2 = Two_Color_value_two;
    Data_styling[Selector_DataStyling_value].data_color_complexity = Color_complexity_value;
  }
    
  // Update plot
  updateVisualization();

});

// ###################
// ## Label switch ###
// ###################

$("#List_UniProtNames").click(function() {
    $("#List_UniProtNames").addClass("active");
    $("#List_IUPHARNames").removeClass("active");
    Label_names = 'UniProt';
    updateVisualization();
});

$("#List_IUPHARNames").click(function() {
      $("#List_UniProtNames").removeClass("active");
      $("#List_IUPHARNames").addClass("active");
      Label_names = 'IUPHAR';
      updateVisualization();
  });

</script>
{% endif %}

<!-- ############# -->
<!-- ## Heatmap ## -->
<!-- ############# -->
{% if Plot_evaluation_json.3 %}


<script>
  $(document).ready(function() {
    // Function to initialize Spectrum color picker
    function initializeColorPicker(elementId,start_color) {
      $("#" + elementId).spectrum({
        color: start_color,
        showPalette: true,
        showInput: true,
        preferredFormat: "hex",
        palette: [
          ["#000", "#FF0000", "#00FF00", "#0000FF", "#FFFF00"],
          ["#FF00FF", "#00FFFF", "#FFFFFF", "#C0C0C0", "#808080"],
          ["#800000", "#808000", "#008000", "#800080", "#008080"],
          ["#000080"]
        ],
        change: function(color) {
          var selectedColor = color.toHexString();
        }
      });
    }
    // Initialize all color pickers
    initializeColorPicker("Heatmap_colorPicker_min","#1a80bb");
    initializeColorPicker("Heatmap_colorPicker_max","#a00000");
  });
</script>

<script>

var heatmap = {{ heatmap_data|safe }};
var label_converter = {{ Label_converter|safe }};
var label_x_converter = {{Heatmap_Label_dict|safe}};

var heatmap_DataStyling = heatmap_DataStyling();


document.addEventListener("DOMContentLoaded", function() {
  // Initialize heatmap 
  Heatmap(heatmap, 'heatmapPlot', heatmap_DataStyling, label_x_converter);
});

// Function to update the visualization
function Heatmap_updateVisualization() {
      // Clear existing SVG content
      d3.select("#heatmapPlot svg").remove();
      // Re-render the visualization
      Heatmap(heatmap, 'heatmapPlot', heatmap_DataStyling, label_x_converter);
    }

$('.dropdown-menu').on('click', function(event){
  event.stopPropagation();
});


// ###################
// ## Color styling ##
// ###################

function UpdateColorPickers() {
  // Color complexity
  const Color_styling = document.querySelector('#Heatmap_color_styling');

  // Color picker containers 
  const Heatmap_Color_min_container = document.getElementById("Heatmap_Color_min_container");
  // const Heatmap_Color_max_container = document.getElementById("Heatmap_Color_max_container");
  const Color_min = document.getElementById("Heatmap_colorPicker_min");
  const Color_max = document.getElementById("Heatmap_colorPicker_max");

  // Get the selected layer value
  const Color_styling_value = Color_styling.value;

  if (Color_styling_value == 'One') {
    Heatmap_Color_min_container.style.display = 'None';
  } else if (Color_styling_value == 'Two'){
    Heatmap_Color_min_container.style.display = 'Block';
  } else if (Color_styling_value == 'Three') {
    Heatmap_Color_min_container.style.display = 'Block';
  }

  // Set color to current color 
  $(Color_min).spectrum("set", heatmap_DataStyling.min_color);
  $(Color_max).spectrum("set", heatmap_DataStyling.max_color);
  
}

// Function to set color pickers to predefined colors
function setColors(colorMin, colorMax, optionValue) {
    $("#Heatmap_colorPicker_min").spectrum("set", colorMin);
    $("#Heatmap_colorPicker_max").spectrum("set", colorMax);
    $("#Heatmap_color_styling").val(optionValue).trigger("change");
  }

// Event listener for "Set Gray scale" button
$("#GrayScale").click(function() {
  heatmap_DataStyling.min_color = "#b8b8b8";
  heatmap_DataStyling.max_color = "#707070";
  setColors(heatmap_DataStyling.min_color, heatmap_DataStyling.max_color, "Two");
});

// Event listener for "Set Gray-Blue" button
$("#GrayBlueScale").click(function() {
  heatmap_DataStyling.min_color = "#97a6c4";
  heatmap_DataStyling.max_color = "#384860";
  setColors(heatmap_DataStyling.min_color, heatmap_DataStyling.max_color, "Two");
});


// Event listener for "Set Red-Blue" button
$("#RedBlueScale").click(function() {
    heatmap_DataStyling.min_color = "#1a80bb";
    heatmap_DataStyling.max_color = "#a00000";
    setColors(heatmap_DataStyling.min_color, heatmap_DataStyling.max_color, "Three");
  });

// Event listener for "Set teal-Magenta" button
$("#TealMagentaScale").click(function() {
    heatmap_DataStyling.min_color = "#298c8c";
    heatmap_DataStyling.max_color = "#800074";
    setColors(heatmap_DataStyling.min_color, heatmap_DataStyling.max_color, "Three");
  });



// Select the Render Plot button
const RenderHeatmap_ColorButton = document.querySelector('#RenderHeatmap_colering');
// Add click event listener to the button
RenderHeatmap_ColorButton.addEventListener('click', function() {

  // Color complexity
  const Color_styling = document.querySelector('#Heatmap_color_styling');
  // Color pickers 
  const Color_min = document.getElementById("Heatmap_colorPicker_min");
  const Color_max = document.getElementById("Heatmap_colorPicker_max");
  

  // Get color complexity value 
  const Color_styling_value = Color_styling.value;

  if (Color_styling_value == 'One') {
    const One_Color_value = $(Color_max).spectrum("get").toHexString();
    heatmap_DataStyling.min_color = '#FFFFFF';
    heatmap_DataStyling.max_color = One_Color_value;
    heatmap_DataStyling.Number_of_colors = 'One';
  } else if (Color_styling_value == 'Two') {
    const Two_Color_value_min = $(Color_min).spectrum("get").toHexString();
    const Two_Color_value_max = $(Color_max).spectrum("get").toHexString();
    heatmap_DataStyling.min_color = Two_Color_value_min;
    heatmap_DataStyling.max_color = Two_Color_value_max;
    heatmap_DataStyling.Number_of_colors = 'Two';
  } else if (Color_styling_value == 'Three') {
    const Two_Color_value_min = $(Color_min).spectrum("get").toHexString();
    const Two_Color_value_max = $(Color_max).spectrum("get").toHexString();
    heatmap_DataStyling.min_color = Two_Color_value_min;
    heatmap_DataStyling.max_color = Two_Color_value_max;
    heatmap_DataStyling.Number_of_colors = 'Three';
  }
    
  // Update plot
  Heatmap_updateVisualization();

});

// ###################
// ## label styling ##
// ###################

// Select the Render Plot button
const RenderHeatmap_LabelButton = document.querySelector('#RenderHeatmap_labels');
// Add click event listener to the button
RenderHeatmap_LabelButton.addEventListener('click', function() {

  // xLabel oritation & position
  const xLabel_styling_dropdown = document.querySelector('#Heatmap_xlabel_styling');
  const xLabel_position_dropdown = document.querySelector('#Heatmap_xlabel_position');
  const xLabel_fontSizeSlider = document.getElementById('Heatmap_fontSizeSlider');
  const yLabel_fontSizeSlider = document.getElementById('Heatmap_receptor_fontSizeSlider');
  
  // xlabel orientation & position value 
  const xlabel_orientation = parseInt(xLabel_styling_dropdown.value);
  const xlabel_position = xLabel_position_dropdown.value;
  const xlabel_fontsize = xLabel_fontSizeSlider.value;
  const ylabel_fontsize = yLabel_fontSizeSlider.value;

  heatmap_DataStyling.rotation = xlabel_orientation;
  heatmap_DataStyling.label_position = xlabel_position;
  heatmap_DataStyling.label_fontsize = xlabel_fontsize;
  heatmap_DataStyling.receptor_fontsize = ylabel_fontsize;
  
  // Update plot
  Heatmap_updateVisualization();

});

// Update the font size label based on slider value
const Heatmap_fontSizeSlider = document.getElementById('Heatmap_fontSizeSlider');
const Heatmap_fontSizeLabel = document.getElementById('Heatmap_fontSizeSliderLabel');
Heatmap_fontSizeSlider.addEventListener('input', () => {
  Heatmap_fontSizeLabel.textContent = `Label Font Size: ${Heatmap_fontSizeSlider.value}px`;
});

// Update the font size label based on slider value
const Heatmap_receptor_fontSizeSlider = document.getElementById('Heatmap_receptor_fontSizeSlider');
const Heatmap_receptor_fontSizeLabel = document.getElementById('Heatmap_receptor_fontSizeSliderLabel');
Heatmap_receptor_fontSizeSlider.addEventListener('input', () => {
  Heatmap_receptor_fontSizeLabel.textContent = `Receptor Font Size: ${Heatmap_receptor_fontSizeSlider.value}px`;
});


// ###################
// ## Data styling ##
// ###################

// Select the Render Plot button
const RenderHeatmap_DataButton = document.querySelector('#RenderHeatmap_DataStyling');
// Add click event listener to the button
RenderHeatmap_DataButton.addEventListener('click', function() {

  // Border choice
  const Border_styling = document.querySelector('#Heatmap_Border_Styling');
  const data_label_fontsizeSlider = document.getElementById('Heatmap_data_fontSizeSlider');
  // Get color complexity value 
  const Border_styling_value = Border_styling.value;
  const data_fontsize = data_label_fontsizeSlider.value;

  if (Border_styling_value === 'No') {
    heatmap_DataStyling.data_border = false;
  } else if (Border_styling_value === 'Yes') {
    heatmap_DataStyling.data_border = true;
  }

  heatmap_DataStyling.data_fontsize = data_fontsize;
  // Update plot
  Heatmap_updateVisualization();

});


// Update the font size label based on slider value
const Heatmap_data_fontSizeSlider = document.getElementById('Heatmap_data_fontSizeSlider');
const Heatmap_data_fontSizeLabel = document.getElementById('Heatmap_data_fontSizeSliderLabel');
Heatmap_data_fontSizeSlider.addEventListener('input', () => {
  Heatmap_data_fontSizeLabel.textContent = `Data Label Font Size: ${Heatmap_data_fontSizeSlider.value}px`;
});

// ########################
// ## Toggle data labels ##
// ########################

document.addEventListener('DOMContentLoaded', (event) => {
    

    const toggleButton = document.getElementById('Heatmap_data_labels');

    toggleButton.addEventListener('click', () => {
      heatmap_DataStyling.datalabels = !heatmap_DataStyling.datalabels; // Toggle the state

        // Update the button appearance
        if (heatmap_DataStyling.datalabels) {
            toggleButton.classList.add('active');
            toggleButton.classList.remove('btn-primary');
            toggleButton.classList.add('btn-success');
        } else {
            toggleButton.classList.remove('active');
            toggleButton.classList.remove('btn-success');
            toggleButton.classList.add('btn-primary');
        }
        // Rerender heatmap
        Heatmap_updateVisualization();
    });
});


// ###################
// ## Label switch ###
// ###################

$("#Heatmap_UniProtNames").click(function() {
    $("#Heatmap_UniProtNames").addClass("active");
    $("#Heatmap_IUPHARNames").removeClass("active");
    heatmap_DataStyling.LabelType = 'UniProt';
    Heatmap_updateVisualization();
});

$("#Heatmap_IUPHARNames").click(function() {
      $("#Heatmap_UniProtNames").removeClass("active");
      $("#Heatmap_IUPHARNames").addClass("active");
      heatmap_DataStyling.LabelType = 'IUPHAR';
      Heatmap_updateVisualization();
  });

</script>
{% endif %}

{% endblock %}
