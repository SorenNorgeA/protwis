{% extends "home/base.html" %}
{% load static %}
{% csrf_token %}

{% block addon_css %}
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/dt/jszip-2.5.0/dt-1.10.16/b-1.5.1/b-html5-1.5.1/datatables.min.css" />
<link rel="stylesheet" href="{% static 'home/css/construct_browser.css' %}" type="text/css" />
<link rel="stylesheet" href="{% static 'home/css/yadcf_bootstrap_version.css' %}" type="text/css" />
<link rel="stylesheet" href="{% static 'home/css/select2.css' %}" type="text/css" />

<!-- configure radio buttons style -->
<style>
	.highlight {
		display: none;
		/* background-color: red; */
	}
</style>

<style type="text/css">
	.dataTables_scrollHeadInner {
		margin-top: 20px;
	}

	table.dataTable thead th,
	table.dataTable tbody td {
		max-width: 65px;
		word-break: break-all;
		overflow: hidden;
		text-overflow: ellipsis;
		white-space: nowrap;
	}

	table.dataTable thead .sorting {
		background-position: right;
	}

	.select2-container select2-container-multi {
		width: 75%;
	}

	.select2-container-multi .select2-choices .select2-search-field input {
		max-width: 50px;
	}

	.yadcf-filter-wrapper {
		position: center;
		display: flex;
		white-space: normal;
		margin-top: 7px;
		width: 50% !important;
	}

	.select2-results {
		background-color: white;
		border: gray;
		width: 150px !important;
	}

	.yadcf-filter-range {
		grid-auto-columns: auto;
		max-width: 50px !important;
		font-family: sans-serif;
		font-size: 80%;
		font-weight: bold;
		margin: auto;
		margin-top: 10%;
		min-width: 40px;
	}

	table.dataTable thead .sorting {
		background-image: none !important;
	}

	table.dataTable thead .sorting_desc {
		background-image: none !important;
	}

	table.dataTable thead .sorting_asc {
		background-image: none !important;
	}

	table.dataTable.compact tbody th,
	table.dataTable.compact tbody td {
		padding: 5px 10px 5px 0px !important;
		/* width: 0px; */
	}

	table.dataTable.compact thead th,
	table.dataTable.compact thead td {
		padding: 5px 10px 5px 0px;
		/* width: 0px; */
	}

	table.dataTable.compact thead tr.over_header th {
		border-bottom: 1px solid #ccc;
	}

	table.dataTable.compact thead th.leftborder {
		border-left: 1px solid;
	}

	table.dataTable.compact thead th.rightborder {
		border-right: 1px solid;
	}

	.yadcf-filter-range {
		max-width: 40px !important;
		font-family: sans-serif;
		font-size: 80%;
		font-weight: bold;
		min-width: 40px;
	}

	.clicked_button {
		background-color: rgb(215, 215, 215);
	}

	#overlay {
		top: 0px;
		position: absolute;
		background: #f8f8f8;
		/*border: 1px solid #333;*/
		-webkit-box-shadow: 5px 0 2px -2px #888;
		box-shadow: 5px 0 2px -2px #888;
	}

	.container {
		width: 90%;
		/* display:flex;
            flex-direction: column; */
	}

	.wrapper {
		overflow-x: scroll;
		overflow-y: hidden;
	}

	#overlay tbody tr {
		background-color: #f8f8f8;
	}

	#count_row th {
		font-size: 11px;
		text-align: center;
	}

	.switch-field label:hover {
		cursor: pointer;
		/* width: 100%; */
	}

	.switch-field input:checked+label {
		background-color: #337ab7;
		/* #a5dc86; */
		box-shadow: none;
	}

	.border-left {
		padding-left: 3px;
	}

	.switch-field label:first-of-type {
		border-radius: 4px 0 0 4px;

	}

	.switch-field label:last-of-type {
		border-radius: 0 4px 4px 0;
	}

	/* This is just for CodePen. */

	.name {
		width: 100px;
		text-overflow: ellipsis;
		cursor: pointer;
		word-break: break-all;
		overflow: hidden;
		white-space: nowrap;
	}

	.name:hover {
		overflow: visible;
		white-space: normal;

	}

	.toolbar_data_css {
		width: 250px;
		margin-right: auto;
		margin-left: 0px;
		/* border: 1px solid; */
		font-family: "Lucida Grande", Tahoma, Verdana, sans-serif;
		font-weight: normal;
		font-size: 120%;
		line-height: 1.625;
	}

	.toolbar_data_css.td {
		height: 15px;
		max-width: 150px;
		overflow: hidden;
		white-space: nowrap;
		text-overflow: ellipsis;
	}
</style>

{% endblock %}
{% block addon_js %}

<script type="text/javascript" src="https://cdn.datatables.net/v/dt/jszip-2.5.0/dt-1.10.16/b-1.5.1/b-html5-1.5.1/datatables.min.js"></script>
<script src="{% static 'home/js/jquery.dataTables.yadcf.js' %}"> </script>
<script src="{% static 'home/js/dataTables.buttons.min.js' %}"> </script>
<script src="{% static 'home/js/select2.js' %}"> </script>
<script src="{% static 'home/js/shading.js' %}"></script>

<script>
	$(document).ready(function() {
		function getCookie(name) {
			let cookieValue = null;
			if (document.cookie && document.cookie !== '') {
				const cookies = document.cookie.split(';');
				for (let i = 0; i < cookies.length; i++) {
					const cookie = cookies[i].trim();
					// Does this cookie string begin with the name we want?
					if (cookie.substring(0, name.length + 1) === (name + '=')) {
						cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
						break;
					}
				}
			}
			return cookieValue;
		}
		const csrftoken = getCookie('csrftoken');

		function myFunction(url, title, win, w, h) {
			const y = win.top.outerHeight / 2 + win.top.screenY - (h / 2);
			const x = win.top.outerWidth / 2 + win.top.screenX - (w / 2);
			return win.open(url, title, 'toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width=' + w + ', height=' + h + ', top=' + y + ', left=' + x);
		}

		var table = $('#structures_scrollable').DataTable({
			stateSave: false,
			processing: true,
			deferRender: true,
			dom: 'B<>flrtip',
            pageLength: 35,
			"lengthChange": false,
			fixedColumns: {
				leftColumns: 2
			},
			"serverSide": true,
			"ajax": "/ligand/biasg/api/?format=datatables",
			"columns": [{
					"data": "id",
					"sortable": false,
					"render": function(data, type, row) {
						var ligand_id = row.ligand_id;
						var my_func = "window.open('experiment/" + data + "/detail')";
						var return_String = "<a href='#'><span class='glyphicon glyphicon-info-sign' onclick=(" + my_func + ")></span></a>";
						var return_span = "<span style=\"display: none;\">" + ligand_id + "</span>";
						return return_span+return_String;
					}
				},
				{
					"data": "class_",
					"sortable": true
					//"title": "class_"
				},
				{
					"data": "receptor_family",
					"sortable": true
					//"title": "receptor_family"
				},
				{
					"data": "uniprot",
					"sortable": true
					//"title": "uniprot"
				},
				{
					"data": "iuphar",
					"sortable": true
					//"title": "iuphar"
				},
				{
					"data": "species",
					"sortable": true
					//"title": "species"
				},
				{
					"data": "endogenous_ligand",
					"sortable": true
				},
				{
					"data": "reference_ligand",
					"sortable": true
				},
				{
					// "data": ["ligand", "ligand_id"],
					"data": "ligand",
					"sortable": true,
					"render": function(data, type, row) {
						var return_String = "<a href ='/ligand/" + row.ligand_id + "/info' target='_blank'>" + data + "</a>";
						return return_String;
					},
				},
				{
					"data": "vendor_quantity",
					"sortable": true
				},
				{
					"data": "article_quantity",
					"sortable": true
				},
				{
					"data": "labs_quantity",
					"sortable": true
				},
				{
					"data": "primary",
					"sortable": true
				},
				{
					"data": "secondary",
					"sortable": true
				},
				{
					"data": "pathways_p1",
					"sortable": true,
					"className": "pathways"
				},
				{
					"data": "pathways_p2",
					"sortable": true,
					"className": "pathways"
				},
				{
					"data": "pathways_p3",
					"sortable": true,
					"className": "pathways"
				},
				{
					"data": "pathways_p4",
					"sortable": true,
					"className": "pathways"
				},
				{
					"data": "pathways_p5",
					"sortable": true,
					"className": "pathways"
				},
				{
					"data": "opmodel_p2_p1",
					"sortable": true,
					"className": "shade"
				},
				{
					"data": "opmodel_p3_p1",
					"sortable": true,
					"className": "shade",
				},
				{
					"data": "opmodel_p4_p1",
					"sortable": true,
					"className": "shade",
				},
				{
					"data": "opmodel_p5_p1",
					"sortable": true,
					"className": "shade",
				},
				{
					"data": "lbf_p2_p1",
					"sortable": true,
					"className": "shade",
				},
				{
					"data": "lbf_p3_p1",
					"sortable": true,
					"className": "shade",
				},
				{
					"data": "lbf_p4_p1",
					"sortable": true,
					"className": "shade",
				},
				{
					"data": "lbf_p5_p1",
					"sortable": true,
					"className": "shade",
				},
				{
					"data": "potency_p2_p1",
					"sortable": true,
					"className": "shade",
				},
				{
					"data": "potency_p3_p1",
					"sortable": true,
					"className": "shade",
				},
				{
					"data": "potency_p4_p1",
					"sortable": true,
					"className": "shade",
				},
				{
					"data": "potency_p5_p1",
					"sortable": true,
					"className": "shade",
				},
				{
					"data": "activity_p1",
					"sortable": true,
					"className": "shade",
					"render": function(data, type, row) {
                        var return_String = data;
                        if (row.standard_type_p1 === "IC50") {
                            var return_String = "<font color='red'>" + data + "</font>";
                            return return_String;
                        }
						if (row.quality_activity_p1 || row.quality_activity_p1 !== '') {
							var return_String = row.quality_activity_p1;
							return return_String;
						}
                        return return_String;
					},
				},
				{
					"data": "activity_p2",
					"sortable": true,
					"className": "shade",
					"render": function(data, type, row) {
                        var return_String = data;
                        if (row.standard_type_p2 === "IC50") {
                            var return_String = "<font color='red'>" + data + "</font>";
                            return return_String;
                        }
						if (row.quality_activity_p2 || row.quality_activity_p2 !== '') {
							var return_String = row.quality_activity_p2;
							return return_String;
						}
                        return return_String;
					},
				},
				{
					"data": "activity_p3",
					"sortable": true,
					"className": "shade",
					"render": function(data, type, row) {
                        var return_String = data;
                        if (row.standard_type_p3 === "IC50") {
                            var return_String = "<font color='red'>" + data + "</font>";
                            return return_String;
                        }
						if (row.quality_activity_p3 || row.quality_activity_p3 !== '') {
							var return_String = row.quality_activity_p3;
							return return_String;
						}
                        return return_String;
					},
				},
				{
					"data": "activity_p4",
					"sortable": true,
					"className": "shade",
					"render": function(data, type, row) {
                        var return_String = data;
                        if (row.standard_type_p4 === "IC50") {
                            var return_String = "<font color='red'>" + data + "</font>";
                            return return_String;
                        }
						if (row.quality_activity_p4 || row.quality_activity_p4 !== '') {
							var return_String = row.quality_activity_p4;
							return return_String;
						}
                        return return_String;
					},
				},
				{
					"data": "activity_p5",
					"sortable": true,
					"className": "shade",
					"render": function(data, type, row) {
                        var return_String = data;
                        if (row.standard_type_p5 === "IC50") {
                            var return_String = "<font color='red'>" + data + "</font>";
                            return return_String;
                        }
						if (row.quality_activity_p5 || row.quality_activity_p5 !== '') {
							var return_String = row.quality_activity_p5;
							return return_String;
						}
                        return return_String;
					},
				},
				{
					"data": "emax_p1",
					"sortable": true,
					"className": "shade",
				},
				{
					"data": "emax_p2",
					"sortable": true,
					"className": "shade",
				},
				{
					"data": "emax_p3",
					"sortable": true,
					"className": "shade",
				},
				{
					"data": "emax_p4",
					"sortable": true,
					"className": "shade",
				},
				{
					"data": "emax_p5",
					"sortable": true,
					"className": "shade",
				},
				{
					"data": "tfactor_p1",
					"sortable": true,
					"className": "shade",
				},
				{
					"data": "tfactor_p2",
					"sortable": true,
					"className": "shade",
				},
				{
					"data": "tfactor_p3",
					"sortable": true,
					"className": "shade",
				},
				{
					"data": "tfactor_p4",
					"sortable": true,
					"className": "shade",
				},
				{
					"data": "tfactor_p5",
					"sortable": true,
					"className": "shade",
				},
				{
					"data": "assay_p1",
					"sortable": true
					//"title": "assay_p1"
				},
				{
					"data": "assay_p2",
					"sortable": true
					//"title": "assay_p2"
				},
				{
					"data": "assay_p3",
					"sortable": true
					//"title": "assay_p3"
				},
				{
					"data": "assay_p4",
					"sortable": true
					//"title": "assay_p4"
				},
				{
					"data": "assay_p5",
					"sortable": true
					//"title": "assay_p5"
				},
				{
					"data": "cell_p1",
					"sortable": true
					//"title": "cell_p1"
				},
				{
					"data": "cell_p2",
					"sortable": true
					//"title": "cell_p2"
				},
				{
					"data": "cell_p3",
					"sortable": true
					//"title": "cell_p3"
				},
				{
					"data": "cell_p4",
					"sortable": true
					//"title": "cell_p4"
				},
				{
					"data": "cell_p5",
					"sortable": true
					//"title": "cell_p5"
				},
				{
					"data": "time_p1",
					"sortable": true
				},
				{
					"data": "time_p2",
					"sortable": true
				},
				{
					"data": "time_p3",
					"sortable": true
				},
				{
					"data": "time_p4",
					"sortable": true
				},
				{
					"data": "time_p5",
					"sortable": true
				},
				{
					"data": "authors",
					"sortable": true,
					"className": "name",
				},
				{
					"data": "doi_reference",
					"sortable": true,
					"className": "name",
					"render": function(data, type, row) {
						var return_String = "<a href ='" + row.publication_link + "'target='_blank'>" + data + "</a>";
						return return_String;
					},
				},

                {
					"data": "ligand_source_id",
					"sortable": false,
					"visible": true,
				},
				{
					"data": "ligand_source_type",
					"sortable": false,
					"visible": true,
				},
				// Invisible fields, this is required for DataTables to fetch the fields
				{
					"data": "ligand_id",
					"sortable": false,
					"visible": false,
				},
				{
					"data": "publication_link",
					"sortable": false,
					"visible": false,
				},
				{
					"data": "quality_activity_p1",
					"sortable": false,
					"visible": false,
				},
				{
					"data": "quality_activity_p2",
					"sortable": false,
					"visible": false,
				},
				{
					"data": "quality_activity_p3",
					"sortable": false,
					"visible": false,
				},
				{
					"data": "quality_activity_p4",
					"sortable": false,
					"visible": false,
				},
				{
					"data": "quality_activity_p5",
					"sortable": false,
					"visible": false,
				},

				{
					"data": "standard_type_p1",
					"sortable": false,
					"visible": false,
				},
				{
					"data": "standard_type_p2",
					"sortable": false,
					"visible": false,
				},
				{
					"data": "standard_type_p3",
					"sortable": false,
					"visible": false,
				},
				{
					"data": "standard_type_p4",
					"sortable": false,
					"visible": false,
				},
				{
					"data": "standard_type_p5",
					"sortable": false,
					"visible": false,
				}


			],
			"columnDefs": [
				// {
				//     "targets":[31,32,33,34,35], "render": function(data, type, row) {
				//         var return_String = "<a href ='" + row.publication_link + "'target='_blank'>"+data+"</a>";
				// 		return return_String;
				// 	},
				//
				// },
				{
					"targets": [19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45],
					"createdCell": function(td, cellData, rowData, row, col) {
						if (!cellData || !$.isNumeric(cellData)) {
							return;
						}

						value = parseFloat(cellData, 2);

						field = Object.keys(rowData)[col];

						function ourFunc(d, index, arr) {
							if (!d[field] || isNaN(d[field])) {
								return null;
							} else {
								return parseFloat(d[field], 2)
							}
						}
						values = table.data().map(ourFunc, {
							field: field
						}).filter((d) => d !== null);

						if (values.length === 0) {
							return;
						}

						max = parseFloat(values.reduce((max, val) => max > val ? max : val), 2);
						min = parseFloat(values.reduce((min, val) => min < val ? min : val), 2);

						lightGrey = 200;
						darkGrey = 120;

						let factor = (value - min) / (max - min);
						let color = lightGrey - factor * (lightGrey - darkGrey);
						let n = Math.round(color);

						$(td).css('background-color', `rgb(${n}, ${n}, ${n})`);
					}
				},
			],

			// pageLength: 35,
            // "lengthMenu": [[10, 25, 50, 2400], [10, 25, 50, 2400]],
			// "lengthChange": true,
			"buttons": [{
					extend: 'csv',
					text: 'Export to CSV',
					className: 'btn btn-primary',
					init: function(api, node, config) {
						$(node).removeClass('dt-button buttons-excel buttons-html5');
					},
					exportOptions: {
						modifier: {
							order: 'current',
							page: 'all',
							search: 'none'
						}
					}
				},
				{
					text: 'Reset Filters',
					className: 'btn btn-primary',
					titleAttr: 'Reset All Filters',
					init: function(api, node, config) {
						$(node).removeClass('dt-button buttons-excel buttons-html5');
					},
					action: function(e, dt, node, config) {
						reset_filters()
					},
				},
				{
					text: 'Get Vendors',
					className: 'btn btn-primary',
					titleAttr: 'Vendors info for top 20 ligands',
					init: function(api, node, config) {
						$(node).removeClass('dt-button buttons-excel buttons-html5');
					},
					action: function(e, dt, node, config) {
						var id = read_ids()
						var result
						$.ajaxSetup({
							headers: {
								"X-CSRFToken": csrftoken
							}
						});
						$.ajax({
							type: 'POST',
							url: '/ligand/vendors',
							data: {
								ids: id,
								csrfmiddlewaretoken: '{{csrf_token }}',
								action: 'post',
							},
							success: function() {

								myFunction('/ligand/browservendors', 'Detail View', window, 850, 1000)
							}
						});
					},
				},
			],
			"drawCallback": function(settings) {
				var columnIds = [];
				calculate_header()
				$('#structures_scrollable').removeClass("highlight");
				$('#structures_scrollable .header-spans th').removeClass("highlight");
				$('#structures_scrollable .table-filter-dropdown th').removeClass("highlight");
				$('#structures_scrollable .table-filter-dropdown th').each(function(index) {
					var tds = $('.dataTable tbody td:nth-child(' + (index + 1) + ')');

					if (tds.length <= tds.filter(':empty').length) {
						columnIds.push(tds[0].cellIndex)
						tds.addClass('highlight');
					}
				});
				if (columnIds) {
					columnIds.forEach((item) => {
						var filterRow = $('.dataTable .table-filter-dropdown th:nth-child(' + (item + 1) + ')');
						filterRow[0].setAttribute("class", "highlight");
					});

					columnIds.forEach((item) => {
						if (item >= 1 && item <= 6) {
							var temp_colspan = $('#receptor').attr('colspan')
							$("#receptor").attr("colspan", temp_colspan - 1)
						}
						if (item >= 7 && item <= 11) {
							var temp_colspan = $('#ligand').attr('colspan')
							$("#ligand").attr("colspan", temp_colspan - 1)

						}
						if (item >= 12 && item <= 13) {
							var temp_colspan = $('#transducers').attr('colspan')
							$("#transducers").attr("colspan", temp_colspan - 1)
							if ($('#transducers').attr('colspan') == 0) {
								$("#transducers").addClass('highlight');
							}
						}
						if (item >= 14 && item <= 18) {
							var temp_colspan = $('#pathways').attr('colspan')
							$("#pathways").attr("colspan", temp_colspan - 1)
						}
						if (item >= 19 && item <= 22) {
							var temp_colspan = $('#opmodel').attr('colspan')
							$("#opmodel").attr("colspan", temp_colspan - 1)
							if ($('#opmodel').attr('colspan') == 0) {
								$("#opmodel").addClass('highlight');
							}
						}
						if (item >= 23 && item <= 26) {
							var temp_colspan = $('#lbf').attr('colspan')
							$("#lbf").attr("colspan", temp_colspan - 1)
							if ($('#lbf').attr('colspan') == 0) {
								$("#lbf").addClass('highlight');
							}
						}
						if (item >= 27 && item <= 30) {
							var temp_colspan = $('#potency').attr('colspan')
							$("#potency").attr("colspan", temp_colspan - 1)
                            if ($('#potency').attr('colspan') == 0) {
								$("#potency").addClass('highlight');
							}
						}
						if (item >= 31 && item <= 35) {
							var temp_colspan = $('#activity').attr('colspan')
							$("#activity").attr("colspan", temp_colspan - 1)
                            if ($('#activity').attr('colspan') == 0) {
								$("#activity").addClass('highlight');
							}
						}
						if (item >= 36 && item <= 40) {
							var temp_colspan = $('#emax').attr('colspan')
							$("#emax").attr("colspan", temp_colspan - 1)
						}
						if (item >= 41 && item <= 45) {
							var temp_colspan = $('#tfactor').attr('colspan')
							$("#tfactor").attr("colspan", temp_colspan - 1)
							if ($('#tfactor').attr('colspan') == 0) {
								$("#tfactor").addClass('highlight');
							}
						}
						if (item >= 46 && item <= 50) {
							var temp_colspan = $('#assay').attr('colspan')
							$("#assay").attr("colspan", temp_colspan - 1)
						}
						if (item >= 51 && item <= 55) {
							var temp_colspan = $('#cell').attr('colspan')
							$("#cell").attr("colspan", temp_colspan - 1)
						}
						if (item >= 56 && item <= 60) {
							var temp_colspan = $('#time').attr('colspan')
							$("#time").attr("colspan", temp_colspan - 1)
						}
					});
				}
			},
		});


		table.on('xhr', function() {
			var json = table.ajax.json();
			var res = json.filterOptions;

			yadcf.init(table, [{
					column_number: 1,
					filter_type: "multi_select",
					filter_delay: 1000,
					filter_container_id: 'class_filter_select',
					select_type: 'select2',
					multiple: true,
					filter_default_label: "Select",
					filter_reset_button_text: false,
					data: res.class,
				},
				{
					column_number: 2,
					filter_type: "multi_select",
					filter_delay: 1000,
					filter_container_id: 'receptor_filter_select',
					select_type: 'select2',
					filter_default_label: "Select",
					filter_reset_button_text: false,
					multiple: true,
					data: res.receptor,
				},
				{
					column_number: 3,
					filter_type: "multi_select",
					filter_delay: 1000,
					filter_container_id: 'uniprot_filter_select',
					select_type: 'select2',
					filter_default_label: "Select",
					filter_reset_button_text: false,
					multiple: true,
					data: res.uniprot,
				},
				{
					column_number: 4,
					filter_type: "multi_select",
					filter_delay: 1000,
					filter_container_id: 'iuphar_filter_select',
					select_type: 'select2',
					filter_default_label: "Select",
					filter_reset_button_text: false,
					multiple: true,
					data: res.iuphar,
				},
				{
					column_number: 5,
					filter_type: "multi_select",
					filter_delay: 1000,
					filter_container_id: 'species_filter_select',
					select_type: 'select2',
					filter_default_label: "Select",
					filter_reset_button_text: false,
					multiple: true,
					data: res.species,
				},
				{
					column_number: 6,
					filter_type: "multi_select",
					filter_delay: 1000,
					filter_container_id: 'endogenous_ligand_filter_select',
					select_type: 'select2',
					filter_default_label: "Select",
					filter_reset_button_text: false,
					multiple: true,
					data: res.endogenous_ligand,
				},
				{
					column_number: 7,
					filter_type: "multi_select",
					filter_delay: 1000,
					filter_container_id: 'reference_ligand_filter_select',
					select_type: 'select2',
					filter_default_label: "Select",
					filter_reset_button_text: false,
					multiple: true,
					data: res.reference_ligand,
				},
				{
					column_number: 8,
					filter_type: "multi_select",
					filter_delay: 1000,
					filter_container_id: 'ligand_filter_select',
					select_type: 'select2',
					filter_default_label: "Select",
					filter_reset_button_text: false,
					multiple: true,
					data: res.ligand,
				},

				{
					column_number: 9,
					filter_type: "range_number",
					filter_delay: 1000,
					filter_container_id: 'vendor_quantity_filter_select',
					filter_default_label: ["Min", "Max"],
					filter_reset_button_text: false,
				}, {
					column_number: 10,
					filter_type: "range_number",
					filter_delay: 1000,
					filter_container_id: 'article_quantity_filter_select',
					filter_default_label: ["Min", "Max"],
					filter_reset_button_text: false,
				}, {
					column_number: 11,
					filter_type: "range_number",
					filter_delay: 1000,
					filter_container_id: 'labs_quantity_filter_select',
					filter_default_label: ["Min", "Max"],
					filter_reset_button_text: false,
				},

				{
					column_number: 12,
					filter_type: "multi_select",
					filter_delay: 1000,
					filter_container_id: 'primary_filter_select',
					select_type: 'select2',
					filter_default_label: "Select",
					filter_reset_button_text: false,
					multiple: true,
					data: res.primary,
				},
				{
					column_number: 13,
					filter_type: "multi_select",
					filter_delay: 1000,
					filter_container_id: 'secondary_filter_select',
					select_type: 'select2',
					filter_default_label: "Select",
					filter_reset_button_text: false,
					multiple: true,
					data: res.secondary,
				},

				{
					column_number: 14,
					filter_type: "multi_select",
					filter_delay: 1000,
					filter_container_id: 'pathways_p1_filter_select',
					select_type: 'select2',
					filter_default_label: "Select",
					filter_reset_button_text: false,
					multiple: true,
					data: res.pathways_p1,
				}, {
					column_number: 15,
					filter_type: "multi_select",
					filter_delay: 1000,
					filter_container_id: 'pathways_p2_filter_select',
					select_type: 'select2',
					filter_default_label: "Select",
					filter_reset_button_text: false,
					multiple: true,
					data: res.pathways_p2,
				}, {
					column_number: 16,
					filter_type: "multi_select",
					filter_delay: 1000,
					filter_container_id: 'pathways_p3_filter_select',
					select_type: 'select2',
					filter_default_label: "Select",
					filter_reset_button_text: false,
					multiple: true,
					data: res.pathways_p3,
				}, {
					column_number: 17,
					filter_type: "multi_select",
					filter_delay: 1000,
					filter_container_id: 'pathways_p4_filter_select',
					select_type: 'select2',
					filter_default_label: "Select",
					filter_reset_button_text: false,
					multiple: true,
					data: res.pathways_p4,
				}, {
					column_number: 18,
					filter_type: "multi_select",
					filter_delay: 1000,
					filter_container_id: 'pathways_p5_filter_select',
					select_type: 'select2',
					filter_default_label: "Select",
					filter_reset_button_text: false,
					multiple: true,
					data: res.pathways_p5,
				},

				{
					column_number: 19,
					filter_type: "range_number",
					filter_delay: 1000,
					filter_container_id: 'opmodel_p2_p1_filter_select',
					filter_default_label: ["Min", "Max"],
					filter_reset_button_text: false,
				}, {
					column_number: 20,
					filter_type: "range_number",
					filter_delay: 1000,
					filter_container_id: 'opmodel_p3_p1_filter_select',
					filter_default_label: ["Min", "Max"],
					filter_reset_button_text: false,
				}, {
					column_number: 21,
					filter_type: "range_number",
					filter_delay: 1000,
					filter_container_id: 'opmodel_p4_p1_filter_select',
					filter_default_label: ["Min", "Max"],
					filter_reset_button_text: false,
				}, {
					column_number: 22,
					filter_type: "range_number",
					filter_delay: 1000,
					filter_container_id: 'opmodel_p5_p1_filter_select',
					filter_default_label: ["Min", "Max"],
					filter_reset_button_text: false,
				},

				{
					column_number: 23,
					filter_type: "range_number",
					filter_delay: 1000,
					filter_container_id: 'lbf_p2_p1_filter_select',
					filter_default_label: ["Min", "Max"],
					filter_reset_button_text: false,
				}, {
					column_number: 24,
					filter_type: "range_number",
					filter_delay: 1000,
					filter_container_id: 'lbf_p3_p1_filter_select',
					filter_default_label: ["Min", "Max"],
					filter_reset_button_text: false,
				}, {
					column_number: 25,
					filter_type: "range_number",
					filter_delay: 1000,
					filter_container_id: 'lbf_p4_p1_filter_select',
					filter_default_label: ["Min", "Max"],
					filter_reset_button_text: false,
				}, {
					column_number: 26,
					filter_type: "range_number",
					filter_delay: 1000,
					filter_container_id: 'lbf_p5_p1_filter_select',
					filter_default_label: ["Min", "Max"],
					filter_reset_button_text: false,
				},

				{
					column_number: 27,
					filter_type: "range_number",
					filter_delay: 1000,
					filter_container_id: 'potency_p2_p1_filter_select',
					filter_default_label: ["Min", "Max"],
					filter_reset_button_text: false,
				}, {
					column_number: 28,
					filter_type: "range_number",
					filter_delay: 1000,
					filter_container_id: 'potency_p3_p1_filter_select',
					filter_default_label: ["Min", "Max"],
					filter_reset_button_text: false,
				}, {
					column_number: 29,
					filter_type: "range_number",
					filter_delay: 1000,
					filter_container_id: 'potency_p4_p1_filter_select',
					filter_default_label: ["Min", "Max"],
					filter_reset_button_text: false,
				}, {
					column_number: 30,
					filter_type: "range_number",
					filter_delay: 1000,
					filter_container_id: 'potency_p5_p1_filter_select',
					filter_default_label: ["Min", "Max"],
					filter_reset_button_text: false,
				},

				{
					column_number: 31,
					filter_type: "range_number",
					filter_delay: 1000,
					filter_container_id: 'activity_p1_filter_select',
					filter_default_label: ["Min", "Max"],
					filter_reset_button_text: false,
				}, {
					column_number: 32,
					filter_type: "range_number",
					filter_delay: 1000,
					filter_container_id: 'activity_p2_filter_select',
					filter_default_label: ["Min", "Max"],
					filter_reset_button_text: false,
				}, {
					column_number: 33,
					filter_type: "range_number",
					filter_delay: 1000,
					filter_container_id: 'activity_p3_filter_select',
					filter_default_label: ["Min", "Max"],
					filter_reset_button_text: false,
				}, {
					column_number: 34,
					filter_type: "range_number",
					filter_delay: 1000,
					filter_container_id: 'activity_p4_filter_select',
					filter_default_label: ["Min", "Max"],
					filter_reset_button_text: false,
				}, {
					column_number: 35,
					filter_type: "range_number",
					filter_delay: 1000,
					filter_container_id: 'activity_p5_filter_select',
					filter_default_label: ["Min", "Max"],
					filter_reset_button_text: false,
				},

				{
					column_number: 36,
					filter_type: "range_number",
					filter_delay: 1000,
					filter_container_id: 'emax_p1_filter_select',
					filter_default_label: ["Min", "Max"],
					filter_reset_button_text: false,
				}, {
					column_number: 37,
					filter_type: "range_number",
					filter_delay: 1000,
					filter_container_id: 'emax_p2_filter_select',
					filter_default_label: ["Min", "Max"],
					filter_reset_button_text: false,
				}, {
					column_number: 38,
					filter_type: "range_number",
					filter_delay: 1000,
					filter_container_id: 'emax_p3_filter_select',
					filter_default_label: ["Min", "Max"],
					filter_reset_button_text: false,
				}, {
					column_number: 39,
					filter_type: "range_number",
					filter_delay: 1000,
					filter_container_id: 'emax_p4_filter_select',
					filter_default_label: ["Min", "Max"],
					filter_reset_button_text: false,
				}, {
					column_number: 40,
					filter_type: "range_number",
					filter_delay: 1000,
					filter_container_id: 'emax_p5_filter_select',
					filter_default_label: ["Min", "Max"],
					filter_reset_button_text: false,
				},

				{
					column_number: 41,
					filter_type: "range_number",
					filter_delay: 1000,
					filter_container_id: 'tfactor_p1_filter_select',
					filter_default_label: ["Min", "Max"],
					filter_reset_button_text: false,
				}, {
					column_number: 42,
					filter_type: "range_number",
					filter_delay: 1000,
					filter_container_id: 'tfactor_p2_filter_select',
					filter_default_label: ["Min", "Max"],
					filter_reset_button_text: false,
				}, {
					column_number: 43,
					filter_type: "range_number",
					filter_delay: 1000,
					filter_container_id: 'tfactor_p3_filter_select',
					filter_default_label: ["Min", "Max"],
					filter_reset_button_text: false,
				}, {
					column_number: 44,
					filter_type: "range_number",
					filter_delay: 1000,
					filter_container_id: 'tfactor_p4_filter_select',
					filter_default_label: ["Min", "Max"],
					filter_reset_button_text: false,
				}, {
					column_number: 45,
					filter_type: "range_number",
					filter_delay: 1000,
					filter_container_id: 'tfactor_p5_filter_select',
					filter_default_label: ["Min", "Max"],
					filter_reset_button_text: false,
				},

				{
					column_number: 46,
					filter_type: "multi_select",
					filter_delay: 1000,
					filter_container_id: 'assay_p1_filter_select',
					select_type: 'select2',
					filter_default_label: "Select",
					filter_reset_button_text: false,
					multiple: true,
					data: res.assay_p1,
				}, {
					column_number: 47,
					filter_type: "multi_select",
					filter_delay: 1000,
					filter_container_id: 'assay_p2_filter_select',
					select_type: 'select2',
					filter_default_label: "Select",
					filter_reset_button_text: false,
					multiple: true,
					data: res.assay_p2,
				}, {
					column_number: 48,
					filter_type: "multi_select",
					filter_delay: 1000,
					filter_container_id: 'assay_p3_filter_select',
					select_type: 'select2',
					filter_default_label: "Select",
					filter_reset_button_text: false,
					multiple: true,
					data: res.assay_p3,
				}, {
					column_number: 49,
					filter_type: "multi_select",
					filter_delay: 1000,
					filter_container_id: 'assay_p4_filter_select',
					select_type: 'select2',
					filter_default_label: "Select",
					filter_reset_button_text: false,
					multiple: true,
					data: res.assay_p4,
				}, {
					column_number: 50,
					filter_type: "multi_select",
					filter_delay: 1000,
					filter_container_id: 'assay_p5_filter_select',
					select_type: 'select2',
					filter_default_label: "Select",
					filter_reset_button_text: false,
					multiple: true,
					data: res.assay_p5,
				},

				{
					column_number: 51,
					filter_type: "multi_select",
					filter_delay: 1000,
					filter_container_id: 'cell_p1_filter_select',
					select_type: 'select2',
					filter_default_label: "Select",
					filter_reset_button_text: false,
					multiple: true,
					data: res.cell_p1,
				}, {
					column_number: 52,
					filter_type: "multi_select",
					filter_delay: 1000,
					filter_container_id: 'cell_p2_filter_select',
					select_type: 'select2',
					filter_default_label: "Select",
					filter_reset_button_text: false,
					multiple: true,
					data: res.cell_p2,
				}, {
					column_number: 53,
					filter_type: "multi_select",
					filter_delay: 1000,
					filter_container_id: 'cell_p3_filter_select',
					select_type: 'select2',
					filter_default_label: "Select",
					filter_reset_button_text: false,
					multiple: true,
					data: res.cell_p3,
				}, {
					column_number: 54,
					filter_type: "multi_select",
					filter_delay: 1000,
					filter_container_id: 'cell_p4_filter_select',
					select_type: 'select2',
					filter_default_label: "Select",
					filter_reset_button_text: false,
					multiple: true,
					data: res.cell_p4,
				}, {
					column_number: 55,
					filter_type: "multi_select",
					filter_delay: 1000,
					filter_container_id: 'cell_p5_filter_select',
					select_type: 'select2',
					filter_default_label: "Select",
					filter_reset_button_text: false,
					multiple: true,
					data: res.cell_p5,
				},

				{
					column_number: 56,
					filter_type: "multi_select",
					filter_delay: 1000,
					filter_container_id: 'time_p1_filter_select',
					select_type: 'select2',
					filter_default_label: "Select",
					filter_reset_button_text: false,
					multiple: true,
					data: res.time_p1,
				}, {
					column_number: 57,
					filter_type: "multi_select",
					filter_delay: 1000,
					filter_container_id: 'time_p2_filter_select',
					select_type: 'select2',
					filter_default_label: "Select",
					filter_reset_button_text: false,
					multiple: true,
					data: res.time_p2,
				}, {
					column_number: 58,
					filter_type: "multi_select",
					filter_delay: 1000,
					filter_container_id: 'time_p3_filter_select',
					select_type: 'select2',
					filter_default_label: "Select",
					filter_reset_button_text: false,
					multiple: true,
					data: res.time_p3,
				}, {
					column_number: 59,
					filter_type: "multi_select",
					filter_delay: 1000,
					filter_container_id: 'time_p4_filter_select',
					select_type: 'select2',
					filter_default_label: "Select",
					filter_reset_button_text: false,
					multiple: true,
					data: res.time_p4,
				}, {
					column_number: 60,
					filter_type: "multi_select",
					filter_delay: 1000,
					filter_container_id: 'time_p5_filter_select',
					select_type: 'select2',
					filter_default_label: "Select",
					filter_reset_button_text: false,
					multiple: true,
					data: res.time_p5,
				},

				{
					column_number: 61,
					filter_type: "multi_select",
					filter_delay: 1000,
					filter_container_id: 'authors_filter_select',
					select_type: 'select2',
					filter_default_label: "Select",
					filter_reset_button_text: false,
					multiple: true,
					data: res.authors,
				},
				{
					column_number: 62,
					filter_type: "multi_select",
					filter_delay: 1000,
					filter_container_id: 'doi_reference_filter_select',
					select_type: 'select2',
					filter_default_label: "Select",
					filter_reset_button_text: false,
					multiple: true,
					data: res.doi_reference,
				},
			]);
			setTimeout(function() {
				var ligand_counter = read_unique_ids();
				var receptor_counter = read_unique_ids_receptor();
				document.getElementById("ligand_counter").innerHTML = ligand_counter;
				document.getElementById("receptor_counter").innerHTML = receptor_counter;
				// shadeTable(table, ["shade"], 120, 200);
			}, 2000);

		});

		function calculate_header(ids) {
			$("#receptor").attr("colspan", 6);
			$("#ligand").attr("colspan", 5);
			$("#transducers").attr("colspan", 2);
			$("#pathways").attr("colspan", 5);
			$("#opmodel").attr("colspan", 4);
			$("#lbf").attr("colspan", 4);
			$("#potency").attr("colspan", 4);
			$("#activity").attr("colspan", 5);
			$("#emax").attr("colspan", 5);
			$("#tfactor").attr("colspan", 5);
			$("#assay").attr("colspan", 5);
			$("#cell").attr("colspan", 5);
			$("#time").attr("colspan", 5);
		}

		function reset_filters() {
			$('#loadingSpinner').show();
			$('#structures_scrollable_body').hide();
			location.reload()
			//yadcf.exResetAllFilters(oTable);
		}
	});
</script>

<script type="text/javascript">
	function read_unique_ids() {
		var ids = [];
		var table = document.getElementById("structures_scrollable")
		var temp_lenght = table.rows.length;
		var l = 0;
		for (var i = 2; i < temp_lenght; i++) {
			var x = table.rows[i].cells[0];
			ids.push($(x).find('span:first')[0].innerText)
		}
		l = countUnique(ids);
		return l
	}

	function read_unique_ids_receptor() {
		var ids = [];
		var table = document.getElementById("structures_scrollable")
		var temp_lenght = table.rows.length;
		var l = 0;
		for (var i = 2; i < temp_lenght; i++) {
			var x = table.rows[i].cells[3];
			ids.push($(x)[0].innerText)
		}
		l = countUnique(ids);
		return l
	}

	function countUnique(iterable) {
		return new Set(iterable).size;
	}

	function read_ids() {
		var ids = [];
		var table = document.getElementById("structures_scrollable")
		var temp_lenght = table.rows.length;
		if (temp_lenght > 22) {
			temp_lenght = 22;
		}
		for (var i = 2; i < temp_lenght; i++) {
			var x = table.rows[i].cells[0];
			ids.push($(x).find('span:first')[0].innerText)
		}
		var myJSON = JSON.stringify(ids);
		return myJSON
	}
</script>
{% endblock %}

{% block content %}
{% autoescape off %}
<div style='padding-top: 0px; font-size: 10px; white-space: nowrap; overflow-y:hidden;  width:100%;'>
	<div class="toolbar_data_css" id="toolbar_data">
		<table class="display compact text-nowrap toolbar_data_css">
			<thead>
				<tr>
					<h4>Showing unique:</h4>
				</tr>
			</thead>

			<tr>
				<td>Ligands</td>
				<td id="ligand_counter"></td>
			</tr>
			<tr>
				<td>Receptors</td>
				<td id="receptor_counter"></td>
			</tr>
		</table>
	</div>

	<div id='structures_scrollable_div'>
		<table class="display compact text-nowrap" id='structures_scrollable' style="width: 100%">
			<thead id="headers">
				<tr class="header-spans" rowspan="2">
					<th><a href="#"><span class="glyphicon glyphicon-info-sign"></span></a></th>
					<th id="receptor" style="text-align:left" colspan="6">
						Receptor</th>
					<th style="border-left: 1px solid black; text-align:left" colspan="5" style="">
						Tested Ligand Pair </th>
					<th id="transducers" style="border-left: 1px solid black; text-align:left" colspan="2" style="">
						Receptor transducers</th>
					<th id="pathways" style="border-left: 1px solid black; text-align:left" colspan="5">
						Pathway Bias Rank Order </th>
					<th id="opmodel" class="shade" style="border-left: 1px solid black; text-align:left" colspan="4">
						Operational model <br> &#916;&#916;(Tau/Ka)</th>
					<th id="lbf" class="shade" style="border-left: 1px solid black; text-align:left" colspan="4">
						Intrinsic relative<br>activity<br>(&#916;&#916;Log(Emax/EC50))</th>
					<th id="potency" class="shade" style="border-left: 1px solid black; text-align:left" colspan="4">
						Potency ratio</th>
					<th id="activity" class="shade" style="border-left: 1px solid black; text-align:left" colspan="5">
						Potency (pEC50 or<br>
						<font color="#FF0000">IC50)</font>
					</th>
					<th id="emax" class="shade" style="border-left: 1px solid black; text-align:left" colspan="5">
						Emax (% of ref ligand)</th>
					<th id="tfactor" class="shade" style="border-left: 1px solid black; text-align:left" colspan="5">
						Transduction coefficient</th>
					<th id="assay" style="border-left: 1px solid black; text-align:left" colspan="5">
						Assay</th>
					<th id="cell" style="border-left: 1px solid black; text-align:left" colspan="5">
						Cell line</th>
					<th id="time" style="border-left: 1px solid black; text-align:left" colspan="5">
						Time resolved</th>
					<th style="border-left: 1px solid black; text-align:left; overflow: hidden;
                          white-space: nowrap;
                          text-overflow: ellipsis;
                  max-width: 250px;" colspan="2">Reference</th>
                  <th>ligand source id</th>
                  <th>ligand source type</th>
				</tr>
				<tr class="table-filter-dropdown">
					<th><a href="#"><span class="glyphicon glyphicon-info-sign"></span></a></th>
					<th id="class_filter_select">Class</th>
					<th id="receptor_filter_select">Rec Fam</th>
					<th id="uniprot_filter_select">UniProt</th>
					<th id="iuphar_filter_select">IUPHAR</th>
					<th id="species_filter_select">Species</th>
					<th id="endogenous_ligand_filter_select">Endogenous<br>Ligand</th>
					<th id="reference_ligand_filter_select">Reference</th>
					<th id="ligand_filter_select">Biased</th>
					<th id="vendor_quantity_filter_select">#Ven<br>dors</th>
					<th id="article_quantity_filter_select">#Arti<br>cles</th>
					<th id="labs_quantity_filter_select">#Labs<br></th>
					<th id="primary_filter_select">Primary</th>
					<th id="secondary_filter_select">Secondary</th>
					<th class="pathways" id="pathways_p1_filter_select">P 1</th>
					<th class="pathways" id="pathways_p2_filter_select">P 2</th>
					<th class="pathways" id="pathways_p3_filter_select">P 3</th>
					<th class="pathways" id="pathways_p4_filter_select">P 4</th>
					<th class="pathways" id="pathways_p5_filter_select">P 5</th>
					<th id="opmodel_p2_p1_filter_select">P 2 / P 1</th>
					<th id="opmodel_p3_p1_filter_select">P 3 / P 1</th>
					<th id="opmodel_p4_p1_filter_select">P 4 / P 1</th>
					<th id="opmodel_p5_p1_filter_select">P 5 / P 1</th>
					<th id="lbf_p2_p1_filter_select">P 2 / P 1</th>
					<th id="lbf_p3_p1_filter_select">P 3 / P 1</th>
					<th id="lbf_p4_p1_filter_select">P 4 / P 1</th>
					<th id="lbf_p5_p1_filter_select">P 5 / P 1</th>
					<th id="potency_p2_p1_filter_select">P 2 / P 1</th>
					<th id="potency_p3_p1_filter_select">P 3 / P 1</th>
					<th id="potency_p4_p1_filter_select">P 4 / P 1</th>
					<th id="potency_p5_p1_filter_select">P 5 / P 1</th>
					<th id="activity_p1_filter_select">P 1</th>
					<th id="activity_p2_filter_select">P 2</th>
					<th id="activity_p3_filter_select">P 3</th>
					<th id="activity_p4_filter_select">P 4</th>
					<th id="activity_p5_filter_select">P 5</th>
					<th id="emax_p1_filter_select">P 1</th>
					<th id="emax_p2_filter_select">P 2</th>
					<th id="emax_p3_filter_select">P 3</th>
					<th id="emax_p4_filter_select">P 4</th>
					<th id="emax_p5_filter_select">P 5</th>
					<th id="tfactor_p1_filter_select">P 1</th>
					<th id="tfactor_p2_filter_select">P 2</th>
					<th id="tfactor_p3_filter_select">P 3</th>
					<th id="tfactor_p4_filter_select">P 4</th>
					<th id="tfactor_p5_filter_select">P 5</th>
					<th id="assay_p1_filter_select">P 1</th>
					<th id="assay_p2_filter_select">P 2</th>
					<th id="assay_p3_filter_select">P 3</th>
					<th id="assay_p4_filter_select">P 4</th>
					<th id="assay_p5_filter_select">P 5</th>
					<th id="cell_p1_filter_select">P 1</th>
					<th id="cell_p2_filter_select">P 2</th>
					<th id="cell_p3_filter_select">P 3</th>
					<th id="cell_p4_filter_select">P 4</th>
					<th id="cell_p5_filter_select">P 5</th>
					<th id="time_p1_filter_select">P 1</th>
					<th id="time_p2_filter_select">P 2</th>
					<th id="time_p3_filter_select">P 3</th>
					<th id="time_p4_filter_select">P 4</th>
					<th id="time_p5_filter_select">P 5</th>
					<th id="authors_filter_select" style="overflow: hidden;
          white-space: nowrap;
          text-overflow: ellipsis;
          max-width: 100px;">Authors</th>
					<th id="doi_reference_filter_select">DOI/ <br>Reference</th>
                    <th></th>
					<th></th>
				</tr>
			</thead>
			<tbody id='structures_scrollable_body'>

			</tbody>
		</table>
	</div>
</div>
<br>
{% endautoescape %}
<br>
{% endblock %}
